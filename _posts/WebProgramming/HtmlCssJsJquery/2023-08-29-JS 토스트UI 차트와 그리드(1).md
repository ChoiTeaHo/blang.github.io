---
title:  "JS 토스트UI 차트와 그리드(1)"
excerpt: "JS 토스트UI 차트와 그리드(1) 입니다."

categories:
  - html-css-js-jquery
tags:
  - [HTML,CSS,JS,jquery]

toc: true
toc_sticky: true

last_modified_at: 2023-08-04T20:00:00-05:00
---

## CSS
### common.css
```css
.indexBody .yarn .slideTitleWrap{width: 1900px;top:45%;}
.indexBody .yarn .slideTitleWrap .chartWrap{height:400px;display:flex;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart{/*border:1px solid #ccc;*/flex:0.33;height:fit-content;background:#FFFFFF;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart{flex-basis: auto;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart:first-child{margin-left:190px;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart:last-child{margin-right:20px;}

.indexBody .yarn .slideTitleWrap .chartWrap>span{position:absolute;white-space:pre-line;font-size:22px;color:#505050;top:75%;padding:5px;border-radius:4px;}
.indexBody .yarn .slideTitleWrap .chartWrap>span#la1{left:20%;transform:translate(-50%,-50%);}
.indexBody .yarn .slideTitleWrap .chartWrap>span#la2{left:52.1%;transform:translate(-50%,-50%);}

.indexBody .yarn .slideMenuWrap{bottom:40px;}
.indexBody .yarn .slideMenuWrap .gridWrap{display:flex;bottom:30px;flex-flow:nowrap;}
.indexBody .yarn .slideMenuWrap .gridWrap p{text-align:left;margin-bottom:5px;font-weight:bold;}
.indexBody .yarn .slideMenuWrap .gridWrap .grid{/*border:4px solid #ccc;*/height:fit-content;background:#FFFFFF;height:355;}
.indexBody .yarn .slideMenuWrap .gridWrap .grdPanel1{flex-flow:column;display:flex;flex:0 0 auto;width:1365px;margin-left:190px;}
.indexBody .yarn .slideMenuWrap .gridWrap .grdPanel1{flex-flow:column;display:flex;flex:0 0 auto;width:320px;margin-left:20px;margin-right:20px}

```



## 메인
### main.jsp
```jsp
<%@page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<!DOCTYPE html>
<head>
<jsp:iclude page="/WEB-INF/jsp/common/toast_ui.jsp" flush="false">
</head>
<body>

<!-- 파이 차트 -->
<div id="pie-chart1" class="chart"></div>
<span id="la1">Total\n값</span>
<span id="la2">Total\n값</span>

<!-- 라인 차트 -->
<div id="line-chart1" class="chart"></div>

<!-- 그리드 -->
<div class="gridWrap">
    <div class="grdPanel1">
        <p>현재 실행중인 작업</p>
        <div id="grid1" class="grid"></div>
    </div>
    <div class="grdPanel2">
        <p>실행 대기중인 작업</p>
        <div id="grid2" class="grid"></div>
    </div>
</body>


<script type="text/javascript">
/**********************************************************************
* 초기화
**********************************************************************/
var clusterMetrics = ""; //얀리소스 매트릭
var clusterRunning = ""; //얀리소스 러닝
var clusterAccepted = ""; //얀리소스 어셉트

var pieChart1; //파이차트1(클러스터 메모리)
var pieChart2; //파이차트2(클러스터 코어)
var lineChart1; //라인차트1(현재실행중인작업)
var grid1; //그리드1(현재실행중인작업)
var grid2; //그리드2(실행대기중인작업)

/**********************************************************************
* Toast Ui Chart 초기기렌더링을 위한 초기값 셋팅
**********************************************************************/
var paramData = {};
fnSyncAjax("POST", "/yarn/getYarnResource", paramData, function(result) {
    clusterMetrics = result[0].metrics[0];
    clusterRunning = result[1].running;
    clusterAccepted = result[2].accepted;
});

/**********************************************************************
* Toast Ui Grid, Chart
**********************************************************************/

$(document).ready(function() {


    $("#la1").text("Total\n" + bytesToGiga(clusterMetrics.totalMB) + " Gi");
    $("#la2").text("Total\n" + clusterMetrics.totalVirtualCores + " Gi");

    // Toast UI Create
    pieChart1 = fnCreatePieChart1(Chart, clusterMetrics, clusterRunning); //파이차트1(클러스터 메모리)
    pieChart2 = fnCreatePieChart2(Chart, clusterMetrics, clusterRunning); //파이차트2(클러스터 코어)
    lineChart1 = fnCreateLineChart1(Chart, clusterMetrics); //라인차트1(현재실행중인작업)
    grid1 = fnCreateGrid1(Grid, clusterRunning); //그리드1(현재실행중인작업)
    grid2 = fnCreateGrid2(Grid, clusterAccepted); //그리드2(실행대기중인작업)

    // 실시간데이터
    setInterval(function() {
        var paramData = {};
        fnSyncAjax1("POST", "/yarn/getYarnResource", paramData, function(result) {
            /* $.each(result, function(idx, data) {....} )*/
           
            // STEP1. GET DATA
            clusterMetrics = result[0].metrics[0];
            clusterRunning = result[1].running;
            clusterAccepted = result[2].accepted;

            // STEP2. DATA 가공 및 검증
            let resultData1 = fnPcssDataPieChart1(clusterMetrics, clusterRunning);
            let resultData2 = fnPcssDataPieChart2(clusterMetrics, clusterRunning);
            let resultData3 = fnPcssDataLineChart1(clusterMetrics);
            let resultData4 = fnPcssDataGrid1(clusterRunning);
            let resultData5 = fnPcssDataGrid2(clusterAccepted);

            // STEP3. SET DATA
            pieChart1.setData(resultData1, 'memory-mb-usages');
            pieChart2.setData(resultData2, 'vcores-usages');
            lineChart1.addData(resultData3, lineChart1.store.state.categories[4]+1);
            grid1.resetData(resultData4);
            grid2.resetData(resultData5);

            // 파이차트 컬러 커스텀
            fnPieUpdateOption(pieChart1, clusterRunning);
            fnPieUpdateOption(pieChart2, clusterRunning);

            $("#la1").text("Total\n" + bytesToGiga(clusterMetrics.totalMB) + " Gi");
            $("#la2").text("Total\n" + clusterMetrics.totalVirtualCores + " Gi");
        });

    }, 10000);
});

</script>

```



## 라이브러리 관련 커스텀한 js 임포트
### toast_ui.jsp
```jsp
<%-- toastUI Chart--%>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/toastui-chart.min.css" media="screen" />
<script src="${pageContext.request.contextPath}/resources/js/toastui-chart.min.js"></script>

<%-- toastUI Grid --%>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/tui-grid.min.css" media="screen" />
<script src="${pageContext.request.contextPath}/resources/js/tui-grid.min.js"></script>

<script>
/**********************************************************************
* TOAST UI CHART
**********************************************************************/
let Chart = new toastui.Chart;

/**********************************************************************
* TOAST UI Grid
**********************************************************************/
let Grid = tui.Grid;
var extOptions = {
    selection: {
        background: '#4daaf9', 
        border: '#004082'
    }, 
    row: {
        even: {
            background: '#eaeaea'
        },
        hover: {
            background: '#ccc'
        }
    }, 
    cell: {
        normal: {
            background: '#fbfbfb', 
            border: '#e0e0e0', 
            showVerticalBorder: true
        }, 
        header: {
            background: '#eee', 
            border: '#ccc', 
            showVerticalBorder: true
        }, 
        rowheader: {
            background: '#ccc', 
            showVerticalBorder: true
        }, 
        editable: {
            background: '#fbfbfb'
        },
        selectedHeader: {
            background: '#d8d8d8'
        }, 
        focused: {
            border: '#418ed4'
        }, 
        disabled: {
            text: '#b0b0b0'
        }, 
        eventRow: {
            background: '#fee'
        }
    }
};

Grid.applyTheme('default', extOptions);

/**********************************************************************
* Pie 차트1
**********************************************************************/
function fnCreatePieChart1(Chart, metrics, running) {

    let dynamicColors = [];
    dynamicColors = fnGetColor(running);

    const el = document.getElementById('pie-chart1');
    const data = fnPcssDataPieChart1(metrics, running);
    const options = {
        chart: { 
            title: '클러스터 메모리', width: 500, height: 350, background: {color: 'rgba(0,0,0,0)'}, 
            animation: {duration: 500}, align: 'center'
        },
        legend: { visible: true, showCheckbox: false }, 
        exportMenu: { visible: false }, 
        series:{
            dataLabels: {
                visible: true 
            }, 
            radiusRange: {
                inner: 70, 
                outer: 120
            }, 
            selectable: true 
        }, 
        theme: {
            title: {
                fontSize: 35, 
                fontWeight: 600
            },
            series: {
                //colors: ['#F15F5F', '#93CC8D'], 
                colors: dynamicColors, 
                lineWidth: 2, 
                strokeStyle: '#000000', 
                dataLabels: {
                    useSeriesColor: false, 
                    lineWidth: 2, 
                    fontSize: 18, 
                    color: '#404040', 
                    textStrokeColor: '#ffffff', 
                    shadowColor: '#ffffff', 
                    shadowBlur: 4 
                }
            }, 
            chart: {
                //backgroundColor: 'rgba(0,0,0,0)'
            }, 
            legend: {
                visible: true, 
                label: {
                    fontSize: 14, 
                    fontWeight: 500
                }
            }
        }
    };
    
    return Chart.constructor.pieChart({ el, data, options });
}

/**********************************************************************
* Pie 차트1
**********************************************************************/
function fnCreatePieChart2(Chart, metrics, running) {

    let dynamicColors = [];
    dynamicColors = fnGetColor(running);

    const el = document.getElementById('pie-chart2');
    const data = fnPcssDataPieChart2(metrics, running);
    const options = {
        chart: { 
            title: '클러스터 코어', width: 500, height: 350, align: 'center'
        },
        legend: { visible: true, showCheckbox: false }, 
        exportMenu: { visible: false }, 
        series:{
            dataLabels: {
                visible: true 
            }, 
            radiusRange: {
                inner: 70, 
                outer: 120
            }, 
            selectable: true 
        }, 
        theme: {
            title: {
                fontSize: 35, 
                fontWeight: 600
            },
            series: {
                //colors: ['#F15F5F', '#93CC8D'], 
                colors: dynamicColors, 
                lineWidth: 2, 
                strokeStyle: '#000000', 
                dataLabels: {
                    useSeriesColor: false, 
                    lineWidth: 2, 
                    fontSize: 18, 
                    color: '#404040', 
                    textStrokeColor: '#ffffff', 
                    shadowColor: '#ffffff', 
                    shadowBlur: 4 
                }
            }, 
            chart: {
                //backgroundColor: 'rgba(0,0,0,0)'
            }, 
            legend: {
                visible: true, 
                label: {
                    fontSize: 14, 
                    fontWeight: 500
                }
            }
        }
    };
    
    return Chart.constructor.pieChart({ el, data, options });
}

/**********************************************************************
* line 차트1
**********************************************************************/
function fnCreateLineChart1(Chart, metrics) {
    const el = document.getElementById('line-chart1');
    let data = fnPcssDataLineChart1(metrics);

    data = {
        categories: [0, 1, 2, 3, 4], 
        series: [{name: 'Running', data: [data[0], data[0], data[0], data[0]]}
                {name: 'Pending', data: [data[1], data[1], data[1], data[1]]}]
    };
    const options = {
        chart: { title: '실시간 작업 상태', width: 370, height: 350, align: 'center' },
        legend: { visible: true, showCheckbox: false }, 
        exportMenu: { visible: false }, 
        xAxis: { title: '모니터링 시간 (1 = 10sec)' }, 
        yAxis: { title: '작업' }, 
        series:{
            shift: true, 
            dataLabels: {
                visible: true,  //데이터라벨표시
                offsetY: -10
            }, 
            selectable: true,  //차트클릭효과 
            spline: true //부드러운곡선
        }, 
        theme: {
            title: {
                fontSize: 35, 
                fontWeight: 600
            },
            lineWidth: 20, 
            legend: {
                visible: true,
                label: {
                    fontSize: 14, 
                    fontWeight: 500
                }
            }, 
            series: {
                colors: ['#F15F5F', '#93CC8D'], 
                dataLabels: {
                    lineWidth: 10, 
                    fontSize: 13, 
                    fontWeight: 300
                    useSeriesColor: true, 
                    textBubble: {
                        visible: true, 
                        paddingY: 3, 
                        paddingX: 6, 
                        arrow: {
                            visible: true, 
                            width: 5, 
                            height: 5, 
                            direction: 'bottom'
                        }
                    }
                }
            }
        }
    };
    return Chart.constructor.lineChart({ el, data, options });
}


/**********************************************************************
* Grid1
**********************************************************************/
function fnCreateGrid1(Grid, running) {
    return new Grid({
        el: document.getElementById('grid1');
        rowHeaders: [
            {
                type: 'rowNum', 
                header: 'No'
            }
        ], 
        columns: [
            {
                header: 'User', 
                name: 'user', 
                width: 90
            }, 
            {
                header: 'AllocatedVCores', 
                name: 'allocatedVCores', 
                width: 145
            }, 
            {
                header: 'AllocatedMB', 
                name: 'allocatedMB', 
                width: 125
            }, 
            {
                header: 'StartedTime', 
                name: 'startedTime', 
                width: 160
            }, 
            {
                header: 'LaunchTime', 
                name: 'user', 
                width: 160
            }, 
            {
                header: 'ElapsedTime', 
                name: 'elapsedTime', 
                width: 140
            }, 
            {
                header: 'Queue', 
                name: 'queue', 
                width: 110
            }, 
            {
                header: 'QueueUsagePercentage', 
                name: 'queueUsagePercentage', 
                width: 190
            }, 
            {
                header: 'ClusterUsagePercentage', 
                name: 'clusterUsagePercentage', 
                width: 206
            }
        ], 
        data: fnPcssDataGrid1(running), 
        scrollX: false, 
        scrollY: true, 
        bodyHeight: 335 
    });
}

/**********************************************************************
* Grid2
**********************************************************************/
function fnCreateGrid2(Grid, clusterAccepted) {
    return new Grid({
        el: document.getElementById('grid2');
        rowHeaders: [
            {
                type: 'rowNum', 
                header: 'No'
            }
        ], 
        columns: [
            {
                header: 'User', 
                name: 'user', 
                width: 90
            }, 
            {
                header: 'StartedTime', 
                name: 'startedTime', 
                width: 160
            }
        ], 
        data: fnPcssDataGrid2(clusterAccepted), 
        scrollX: false, 
        scrollY: true, 
        bodyHeight: 335 

    });
}

/**********************************************************************
* TOAST UI DATA SET
**********************************************************************/
//클러스터 메모리
function fnPcssDataPieChart1(metrics, running) {

    let series = [];
    let availableMBPercent = fnRound(((metrics.availableMB / metrics.totalMB) * 100), 2); //현재여유메모리(%)
    let allocatedMBPercent; //현재사용메모리
    let userNm; //사용자

    if(running) {
        let arrAllocatedMB = [];
        for(var i=0; i<running.length; i++) {
            arrAllocatedMB.push(running[i].clusterUsagePercentage); //러닝중인 각각의 사용중인 메모리 arr생성
        }

        arrAllocatedMB.sort((a, b) => b - a); //정렬

        for(var i=0; i<running.length; i++) {
            userNm = running[i].user;
            allocatedMBPercent = fnRound(arrAllocatedMB[i], 2);
            series.push({ name: userNm + '= ' + allocatedMBPercent + '% (' + bytesToGiga(metrics.availableMB) + ' Gi)', data: availableMBPercent });
        }
        
        let resultData = 
            !metrics || !running ?
            {
                categories: ['memory-mb-usages'], 
                series: [{ name: 'Used = 0 Gi', data: 0.0 } 
                        , { name: 'available = 0 Gi', data: 0.0 }]
            }
            :
            {
                categories: ['memory-mb-usages']
                , series
            };

        return resultData;
    }
}

//클러스터 코어
function fnPcssDataPieChart2(metrics, running) {

    let series = [];
    let availableVCoresPercent = fnRound(((metrics.availableVirtualCores / metrics.totalVirtualCores) * 100), 2); //현재여유코어(%)
    let allocatedVCorePercent; //현재사용자별 사용코어(%)
    let userNm; //사용자

    if(running) {
        let arrAllocatedVCores = [];
        for(var i=0; i<running.length; i++) {
            arrAllocatedVCores.push( (running[i].allocatedVCores / metrics[i].totalVirtualCores ) * 100); //러닝중인 각각의 사용중인 코어의 점유율 arr생성
        }

        arrAllocatedVCores.sort((a, b) => b - a); //정렬

        for(var i=0; i<running.length; i++) {
            userNm = running[i].user;
            allocatedVCorePercent = fnRound(arrAllocatedVCores[i], 2);
            series.push({ name: userNm + '= ' + allocatedVCorePercent + '\%', data: allocatedVCorePercent }); //각각의 사용자별 코어 점유율 출력
        }
        series.push({ name: 'availableVCores = ' + availableVCoresPercent + '% (' + metrics.availableVirtualCores + ')', data: availableVCoresPercent }); //여유 코어 출력
    }
    let resultData = 
        !metrics || !running ?
        {
            categories: ['vcores-usages'], 
            series: [{ name: 'Used = 0', data: 0.0 } 
                    , { name: 'available = 0', data: 0.0 }]
        }
        :
        {
            categories: ['vcores-usages'], 
            , series
        };

    return resultData;    
}

//실시간 작업 상태
function fnPcssDataLineChart1(metrics) {
    let resultData = [];
    if(metrics) {
        resultData.push(metrics.appsRunning);
        resultData.push(metrics.appsPending);
    }
    return resultData;
}

//현재 실행중인 작업
function fnPcssDataGrid1(running) {
    let resultData = [];
    if (running) {
        for(var i=0; i<running.length; i++) {
            resultData.push({
                user: running[i].user, 
                allocatedVCores: running[i].allocatedVCores, 
                allocatedMB: running[i].allocatedMB, 
                startedTime: running[i].startedTime, 
                launchTime: running[i].launchTime, 
                elapsedTime: running[i].elapsedTime, 
                queue: running[i].queue, 
                queueUsagePercentage: running[i].queueUsagePercentage, 
                clusterUsagePercentage: running[i].clusterUsagePercentage
            });
        }
    }
    return resultData;
}

//현재 실행중인 작업
function fnPcssDataGrid2(accepted) {
    let resultData = [];
    if (accepted) {
        for(var i=0; i<accepted.length; i++) {
            resultData.push({
                user: accepted[i].user, 
                startedTime: accepted[i].startedTime
            });
        }
    }
    return resultData;
}

/**********************************************************************
* Pie 차트 옵션 업데이트
**********************************************************************/
function fnPieUpdateOption(chart, running) {

    let dynamicColors = [];
    dynamicColors = fnGetColor(running);

    //전체옵션변경
    const chartId = chart.containerEl.id;
    let chartOption;
    if(chartId == 'pie-chart1') chartOption = { title: '클러스터 메모리', width: 500, height: 350, background: {color: 'rgba(0,0,0,0)'}, animation: {duration: 500}, align: 'center' };
    if(chartId == 'pie-chart2') chartOption = { title: '클러스터 코어', width: 500, height: 350, background: {color: 'rgba(0,0,0,0)'}, animation: {duration: 500}, align: 'center' }
    
    chart.setOptions({
        chart: chartOption, 
        legend: { visible: true, showCheckbox: false }, 
        exportMenu: { visible: false }, 
        series:{
            dataLabels: {
                visible: true 
            }, 
            radiusRange: {
                inner: 70, 
                outer: 120
            }, 
            selectable: true 
        }, 
        theme: {
            title: {
                fontSize: 35, 
                fontWeight: 600
            },
            series: {
                //colors: ['#F15F5F', '#93CC8D'], 
                colors: dynamicColors, 
                lineWidth: 2, 
                strokeStyle: '#000000', 
                dataLabels: {
                    useSeriesColor: false, 
                    lineWidth: 2, 
                    fontSize: 18, 
                    color: '#404040', 
                    textStrokeColor: '#ffffff', 
                    shadowColor: '#ffffff', 
                    shadowBlur: 4 
                }
            }, 
            chart: {
                //backgroundColor: 'rgba(0,0,0,0)'
            }, 
            legend: {
                visible: true, 
                label: {
                    fontSize: 14, 
                    fontWeight: 500
                }
            }
        }
    });

}

//파이차트 동적 색상 처리
function fnGetColor(running) {
    let arrColors = [];
    const lastColors = '#93CC8D'; //green
    const defaultColors = ['#FF7777', '#BDDDF2', '#FFE400', '#5F00FF', '#FF5E00'
                            , '#D2F4CA', '#BDDDF2', '#FAF4C0', '#A6A6A6', '#7052F9'
                            , '#4C8CF8', '#E8FF3C', '#A3FD3C', '#FC3B86', '#ED9DFB'];

    if(running == null) {
        arrColors.push('#FF7777');
        arrColors.push(lastColors);
        return arrColors;
    }

    for(var i=0; i<running.length; i++) {
        arrColors.push(defaultColors[i]);
    }

    arrColors[arrColors.length] = lastColors;

    return arrColors;
}

//number to TwoDecimalPlaces DATA
function fnRound(number, decimalPlaces) {
    return parseFloat(number, toFixed(decimalPlaces));
}

//bytes To gigabaytes DATA
function bytesToGiga(param) {
    const bytes = param;
    const gigabytes = bytes / 1024;
    return gigabytes.toFixed(1);
}
</script>

```

