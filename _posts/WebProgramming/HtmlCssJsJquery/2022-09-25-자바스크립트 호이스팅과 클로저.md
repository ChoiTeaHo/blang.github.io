---
title:  "자바스크립트 호이스팅과 클로저"
excerpt: "자바스크립트 호이스팅과 클로저 입니다."

categories:
  - html-css-js-jquery
tags:
  - [HTML,CSS,JS,jquery]

toc: true
toc_sticky: true

last_modified_at: 2022-09-01T20:00:00-05:00
---

## 클로저
: 아래 매우 이해하기 좋은 자료가 있다. 

> 참고블로그 [링크](https://ppss.kr/archives/168469)
> 참고유튜브 [링크](https://youtu.be/tpl2oXQkGZs)


### CASE1. 탐색과정 이해하기
```js
let one;
one = 1;

function addOne(num) {
    console.log(one + num);
}

addOne(5);

```
아래 내용을 보고 깊이를 탐색하는 과정을 이해한다.
1. 전역 렉시컬환경 one (변수타입) 메모리 할당 undefined
2. 전역 렉시컬환경 one 값 1 초기화
3. 전역 렉시컬환경 addOne (펑션타입) 메모리 할당 
4. 내부 렉시컬환경 함수호출함
    - one, num 2개의 변수가 사용되고 있는 것을 확인함. (우선 내부렉시컬환경에서 찾는다.)
    - 내부렉시컬 환경에 num 메모리 할당과 동시에 값 5를 초기화 함. 
    - 내부렉시컬 환경에 one 변수가 존재하지 않으므로 외부의 렉시컬 환경에서 찾기 시작함.
    - 아까 저장한 one 변수값
  
  
### CASE2. 클로저 이해하기
```js
function makeAddr(x) {
    return function(y) {
        return x + y;
    }
}

const add3 = makeAddr(3);
console.log(add3(2));

```

1. 전역 렉시컬환경 makeAddr (펑션타입) 메모리 할당
2. 전역 렉시컬환경 add3 (변수타입) 메모리 할당 undefined
3. 내부 렉시컬환경 함수호출함
    - 리턴 대상이 익명의 펑션(function) 임을 확인함.
    - 내부렉시컬 환경에 x 메모리 할당과 동시에 인자값 3을 초기화 함. 
    - 리턴
4. 전역 렉시컬환경 add3 변수값을 리턴받은 익명의 펑션(function)으로 초기화
5. 내부 렉시컬환경의 익명의 펑션(function) 함수호출함
    - x, y 2개의 변수가 사용되고 있는 것을 확인함. (우선 내부렉시컬환경에서 찾는다.)
    - 익명의 펑션(function) 내부렉시컬 환경에 y 메모리 할당과 동시에 값 2를 초기화 함. 
    - 내부렉시컬 환경에 x 변수가 존재하지 않으므로 외부의 렉시컬 환경에서 찾기 시작함. 
    - 아까 저장한 x 변수값을 참조함.
6. 클로저를 통한 은닉화 구현 SUCCESS.

> ***정리)***  
> 외부 함수(`makeAddr()`) 의 실행이 끝나고 외부 함수가 소멸된 이후에도
> 내부 함수(익명의펑션)가 외부 함수(`makeAddr()`) 의 변수에 접근할 수 있는 구조를 클로저라고 한다.
>   
> 외부 환경에서 변수 add3가 외부 함수(`makeAddr()`) 을 참조하고 있어서 `makeAddr()` 함수는 변수 x 로 인해 계속 실행 중의 상태로 놓이게 된다. 결국 메모리에서 사라지지 않고 사용 가능하게 된다.
>   
> const add3 = makeAdder(3)  
> 위 코드에서 사실 외부 함수(`makeAddr()`) 의 실행이 끝나면 이 함수의 지역변수 x가 메모리에서 제거
> 될 것이라고 생각했다. 하지만 내부 함수의 익명 함수가 외부환경으로 (리턴)나오면서 
> 외부 함수의 x을 참조하고 있는 상태를 가지기 때문에 변수 스코프는 makeAdder(3) 이 실행되는 실행환경까지 확장된다는 것이 핵심이다.
  
실행환경에서 외부 함수 outer을 사용하는 inner변수를 통해 outer에서 반환하는 익명 함수가 실행환경까지 범위가 확장된다!  
{: .notice--info}

### 클로저의 조건
1. 내부 함수가 익명 함수로 되어 외부 함수의 return 값으로 사용되어야 한다.
2. 반환되는 내부 함수는 외부 함수의 실행환경에서 실행 된다. (확장된다는 개념을 확인했다.)
3. 내부 함수에서 사용되는 변수는 외부 함수의 변수 스코프에 있어야 한다.
