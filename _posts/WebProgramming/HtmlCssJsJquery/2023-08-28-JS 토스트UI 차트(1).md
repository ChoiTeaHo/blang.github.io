---
title:  "JS 토스트UI 차트(1)"
excerpt: "JS 토스트UI 차트(1) 입니다."

categories:
  - html-css-js-jquery
tags:
  - [HTML,CSS,JS,jquery]

toc: true
toc_sticky: true

last_modified_at: 2023-08-04T20:00:00-05:00
---

## CSS
### common.css
```css
.indexBody .yarn .slideTitleWrap{width: 1900px}
.indexBody .yarn .slideTitleWrap .chartWrap{height:400px;display:flex;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart{flex:0.33;height:fit-content;background:#FFFFFF;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart{flex-basis:auto;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart:first-child{margin-left:190px;}
.indexBody .yarn .slideTitleWrap .chartWrap .chart:last-child{margin-right:20px;}

.indexBody .yarn .slideTitleWrap .chartWrap>span{position:absolute; white-space:pre-line;font-size:22px;color:#505050;top:75%;padding:5px;border-radius:4px;}
.indexBody .yarn .slideTitleWrap .chartWrap>span#la1{left:20.3%;transform:translate(-50%,-50%)}
.indexBody .yarn .slideTitleWrap .chartWrap>span#la2{left:49.6%;transform:translate(-50%,-50%)}

```

## 메인
### main.jsp
```jsp
<%@page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<!DOCTYPE html>
<head>
<jsp:iclude page="/WEB-INF/jsp/common/toast_ui.jsp" flush="false">
</head>
<body>


<div id="div6" class"yarn">
<div class="slideTitleWrap">
<div id="pie-chart1" class="chart"></div> <!-- 파이 차트 -->
<div id="line-chart1" class="chart"></div> <!-- 라인 차트 -->
</div>
</div>

<span id="la1">Total\n값</span>
<span id="la2">Total\n값</span>
</body>

<script type="text/javascript">
/**********************************************************************
* 초기화
**********************************************************************/
var clusterMetrics = "";
var clusterRunning = "";
var clusterAccepted = "";
var pieChart1; 
var lineChart1; 

/**********************************************************************
* Toast Ui Chart 초기기렌더링을 위한 초기값 셋팅
**********************************************************************/
var paramData = {};
fnSyncAjax("POST", "/yarn/getYarnResource", paramData, function(result) {
    clusterMetrics = result[0].metrics[0];
    clusterRunning = result[1].running;
    clusterAccepted = result[2].accepted;
});

/**********************************************************************
* Toast Ui Chart
**********************************************************************/

$(document).ready(function() {


    $("#la1").text("Total\n" + bytesToGiga(clusterMetrics.totalMB) + " Gi");
    $("#la2").text("Total\n" + clusterMetrics.totalVirtualCores + " Gi");

    // Toast UI Create
    pieChart1 = fnCreatePieChart1(Chart, clusterMetrics); 
    lineChart1 = fnCreateLineChart1(Chart, clusterMetrics); 

    // 실시간데이터
    setInterval(function() {
        var paramData = {};
        fnSyncAjax1("POST", "/yarn/getYarnResource", paramData, function(result) {
            
            // STEP1. GET DATA
            clusterMetrics = result[0].metrics[0];
            clusterRunning = result[1].running;
            clusterAccepted = result[2].accepted;

            // STEP2. DATA 가공 및 검증
            let resultData1 = fnToastGetData("pieChart1", clusterMetrics);
            let resultData3 = fnToastGetData("lineChart1", clusterMetrics);

            // STEP3. SET DATA
            pieChart1.setData(resultData1, 'memory-mb-usages');
            lineChart1.addData(resultData3, lineChart1.store.state.categories[4]+1);
            
            $("#la1").text("Total\n" + bytesToGiga(clusterMetrics.totalMB) + " Gi");
            $("#la2").text("Total\n" + clusterMetrics.totalVirtualCores + " Gi");
        });
    }, 10000);


});

</script>

```


## 라이브러리 관련 커스텀한 js 임포트
### toast_ui.jsp
```jsp
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/toastui-chart.min.css" media="screen" />
<script src="${pageContext.request.contextPath}/resources/js/toastui-chart.min.js"></script>

<script>
/**********************************************************************
* TOAST UI CHART
**********************************************************************/
let Chart = new toastui.Chart;

/**********************************************************************
* Pie 차트1
**********************************************************************/
function fnCreatePieChart1(Chart, clusterMetrics) {
    const el = document.getElementById('pie-chart1');
    const data = fnToastGetData("pieChart1", clusterMetrics);
    options = {
        chart: { 
            title: '클러스터 메모리', width: 500, height: 350, background: {color: 'rgba(0,0,0,0)'}, 
            animation: {duration: 500}, align: 'center', 
        },
        legend: { visible: true, showCheckbox: false }, 
        exportMenu: { visible: false }, 
        series:{
            dataLabels: {
                visible: false, 
            }, 
            radiusRange: {
                inner: 70, 
                outer: 120
            }, 
            selectable: true 
        }, 
        theme: {
            title: {
                fontSize: 35, 
                fontWeight: 600
            },
            series: {
                colors: ['#F15F5F', '#93CC8D'], 
                lineWidth: 2, 
                strokeStyle: '#000000', 
                dataLabels: {
                    useSeriesColor: false, 
                    lineWidth: 2, 
                    fontSize: 18, 
                    color: '#404040', 
                    textStrokeColor: '#ffffff', 
                    shadowColor: '#ffffff', 
                    shadowBlur: 4 
                }
            }, 
            chart: {
                //backgroundColor: 'rgba(0,0,0,0)'
            }
        }, 
        legend: {
            visible: true, 
            label: {
                fontSize: 14, 
                fontWeight: 500
            }
        }
    };
    
    return Chart.constructor.pieChart({ el, data, options });
}
/**********************************************************************
* line 차트1
**********************************************************************/
function fnCreateLineChart1(Chart, clusterMetrics) {
    const el = document.getElementById('line-chart1');
    
    let data = fnToastGetData("lineChart1", clusterMetrics);
    data = {
        categories: [0, 1, 2, 3, 4], 
        series: [
                {name: 'Running', data: [data[0], data[0], data[0], data[0]]}
                {name: 'Pending', data: [data[1], data[1], data[1], data[1]]}
                ]
    };
    const options = {
        chart: { title: '실시간 작업 상태', width: 500, height: 350, align: 'center' },
        legend: { visible: true, showCheckbox: false }, 
        exportMenu: { visible: false }, 
        xAxis: { title: '모니터링 시간 (1 = 10sec)' }, 
        yAxis: { title: '작업' }, 
        series:{
            shift: true, 
            dataLabels: {
                visible: true,  //데이터라벨표시
                offsetY: -10
            }, 
            selectable: true,  //차트클릭효과 
            spline: true //부드러운곡선
        }, 
        theme: {
            title: {
                fontSize: 35, 
                fontWeight: 600
            },
            lineWidth: 20, 
            legend: {
                visible: true,
                label: {
                    fontSize: 14, 
                    fontWeight: 500
                }
            }, 
            series: {
                colors: ['#F15F5F', '#93CC8D'], 
                dataLabels: {
                    lineWidth: 10, 
                    fontSize: 13, 
                    fontWeight: 300
                    useSeriesColor: true, 
                    textBubble: {
                        visible: true, 
                        paddingY: 3, 
                        paddingX: 6, 
                        arrow: {
                            visible: true, 
                            width: 5, 
                            height: 5, 
                            direction: 'bottom'
                        }
                    }
                }
            }
        }
    };
    return Chart.constructor.lineChart({ el, data, options });
}
/**********************************************************************
* TOAST UI DATA SET
**********************************************************************/
function fnToastGetData(name, resData) {

    let resultData;
    let resultArrData = [];

    switch (name) {
    case "pieChart1":

        let allocatedMBPercent = parseFloat(((resData.allocatedMB / resData.totalMB) * 100).toFixed(2));
        let availableMBPercent = parseFloat(((resData.availableMB / resData.totalMB) * 100).toFixed(2));

        resultData = 
            !resData ? 
            {
                categories: ['memory-mb-usages'], 
                series: [
                        { name: 'Used = 0 Gi', data: 0.0} 
                        , { name: 'available = 0 Gi', data: 0.0} 
                        ]
            }
            :
            {
                categories: ['memory-mb-usages'], 
                series: [
                        { name: 'Used = ' + bytesToGiga(resData.allocatedMB) + ' Gi', data: allocatedMBPercent } 
                        , { name: 'available = ' + bytesToGiga(resData.availableMB) + ' Gi', data: availableMBPercent } 
                        ]
            };
        break;
    
    case "lineChart1":
        resultArrData = [];
        if (resData) {
            resultArrData.push(resData.appsRunning); 
            resultArrData.push(resData.appsPending); 
        }
        return resultArrData;
        
    }
    return resultData;
}

//bytes To gigabaytes DATA
function bytesToGiga(param) {
    const bytes = param;
    const gigabytes = bytes / 1024;
    return gigabytes.toFixed(1);
}
</script>

```


