---
title:  "자바API JSON 핸들링 유틸"
excerpt: "자바API JSON 핸들링 유틸 입니다."

categories:
  - java
tags:
  - [java]

toc: true
toc_sticky: true

last_modified_at: 2023-08-17T09:00:00-18:00:00
---

## HomeController.java
```java
import 패키지.util.HttpUtil;
import 패키지.util.StringUtil;

```

### getYarnResourceData()
```java

private static final YARN_RESOURCE_METRIC = "http://주소:포트/ws/v1/cluster/metrics/";
private static final YARN_RESOURCE_INFO = "http://주소:포트/ws/v1/cluster/info/";
private static final YARN_RESOURCE_APP = "http://주소:포트/ws/v1/cluster/app/";

/*********************
 * GET Yarn Resource Manager REST API
 * 응답된 JSON 결과를 파싱하고 프론트로 넘긴다.
 * 
 * @param 
 * @return List<Map<String, Object>>
 * @throws
 *********************/
@ResponseBody
@RequestMapping(value="/getYarnResourceData",method = RequestMethod.POST)
public List<Map<String, Object>> getYarnResourceData() throws Exception{
	
  logger.info("HomeController getYarnResourceData start  >>");
  
  List<Map<String, Object>> resultList = new ArrayList<Map<String, Object>>();
    
  try {
    // Yarn Resource Manager REST API (JSON ROOT KEY)
    // 최상위 key는 공식홈페이지에서 원하는 API 확인
    String[] yarnResource = {"clusterMetrics", "clusterInfo"};

    for(int i=0; i<yarnResource.length; i++) {

      //STEP1. GET JSON
      String responseData = ""; //응답데이터
      switch (yarnResource[i]) {
        case "clusterMetrics": 
          responseData = HttpUtil.connectGET(YARN_RESOURCE_METRIC);
          break;
        case "clusterInfo": 
          responseData = HttpUtil.connectGET(YARN_RESOURCE_INFO);
          break;
      }
      System.out.println((yarnResource[i] + " => GET: " + responseData);

      //Map 으로 사용하고싶은경우 ==> jsonToMap(responseData);
      //List<Map> 으로 사용하고싶은경우 ==> jsonToListMap(responseData);

      resultList.add(jsonToListMap(responseData));
    }
    
  } catch (Exception e) {
    e.printStackTrace();		
  } 
    
  return resultJSON;
}

```

> ***HttpUtil.connectGET***    
> 추후작성  


## StringUtil.java
```java
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;

```

### mapToStrJson() : JSON맵 > 완전한JSON문자열
```java
/*********************
 * map 객체를 js가 핸들링 할 수 있는 완전한 json 형태 문자열로 변환<br>
 *  
 * @param mapJson - Map<String, Object>
 * @return String - 이스케이프 처리된 문자열
 * @throws
 *********************/
public static String mapToStrJson(Map<String, Object> mapStrJson) {

  StringBuilder jsonStringBuilder = new StringBuilder();
  jsonStringBuilder.append("{");
  boolean firstEntry = true; //첫회 skip
  for (Map.Entry<String, Object> entry : mapStrJson.entrySet()) {
      if (!firstEntry) {
          jsonStringBuilder.append(",");
      }
      jsonStringBuilder.append("\"").append(entry.getKey()).append("\":");
      Object value = entry.getValue();
      if (value instanceof String) {
          jsonStringBuilder.append("\"").append(value).append("\"");
      } else if(value instanceof Double) {
      	// Gson 라이브러리의 키값이 int 형은 double 로 처리
      	jsonStringBuilder.append("\"").append(value).append("\"");
      } else {
          jsonStringBuilder.append(value);
      }
      firstEntry = false;
  }
  jsonStringBuilder.append("}");

  String jsonString = jsonStringBuilder.toString();
  System.out.println(jsonString);
  return jsonString;
}

```

### jsonToMap() : JSON문자열 > 맵
```java
/*********************
 * json 형태의 문자열을 맵 객체로 변환<br>
 *  
 * @param json 형태의 문자열
 * @return Map<String, Object>
 * @throws
 *********************/
public static Map<String, Object> jsonToMap(String strJson) {

  Map<String, Object> mapJson = new HashMap<String, Object>();

  JsonObject jsonObject = JsonParser.parseString(resJson).getAsJsonObject();
  for(String key : jsonObject.keySet()) {
    //String strKey = key; //키
    JsonElement jsonElement = jsonObject.get(key);
    Object value = getJsonToObj(jsonElement);

    mapJson.put(key, value);
  }
  return mapJson;
}

```

### jsonToListMap() : JSON문자열 > 리스트맵
```java
/*********************
 * json 형태의 문자열을 리스트맵 객체로 변환<br>
 *  
 * @param json 형태의 문자열
 * @return List<Map<String, Object>>
 * @throws
 *********************/
public static List<Map<String, Object>> jsonToListMap(String strJson) {

  List<Map<String, Object>> listJson = new ArrayList<Map<String, Object>>();

  JsonObject jsonObject = JsonParser.parseString(resJson).getAsJsonObject();
  for(String key : jsonObject.keySet()) {
    //String strKey = key; //키
    JsonElement jsonElement = jsonObject.get(key);
    Object value = getJsonToObj(jsonElement);
    Map<String, Object> mapJson = new HashMap<String, Object>();
    mapJson.put(key, value);

    listJson.add(mapJson);
  }
  return listJson;
}

```

### (중요) getJsonToObj() : JSON엘리먼트 > 오브젝트
```java
/*********************
 * com.google.gson.JsonElement.JsonObject 객체를<br>
 * Object 타입으로 변환
 * 프론트에서 핸들링시 다양한 타입을 꺼낼 수 있도록 처리한다.
 *  
 * @param com.google.gson.JsonElement
 * @return Object
 * @throws
 *********************/
public static Object getJsonToObj(JsonElement jsonElement) {
  //기본적인 원시 타입인지 확인
  if (jsonElement.isJsonPrimitive()) {
    if (jsonElement.getAsJsonPrimitive().isString()) {
      return jsonElement.getAsString();
    } else if (jsonElement.getAsJsonPrimitive().isNumber()) {
      return jsonElement.getAsNumber();
    } else if (jsonElement.getAsJsonPrimitive().isBoolean()) {
      return jsonElement.getAsBoolean();
    }
  }
  //객체인경우 재귀호출로 원시타입까지 처리
  else if (jsonElement.isJsonObject()) {
    JsonObject jsonObject = jsonElement.getAsJsonObject();
    Map<String, Object> nestedMap = new HashMap<String, Object>();
    for (String key : jsonObject.keySet()) {
      JsonElement resultElement = jsonObejct.get(key);
      nestedMap.put(key, getJsonToObj(resultElement));
    }
    return nestedMap;
  }
  return null;
}

```

