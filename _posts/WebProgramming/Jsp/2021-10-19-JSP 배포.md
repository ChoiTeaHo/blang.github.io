---
title:  "JSP 배포"
excerpt: "JSP 배포 입니다."

categories:
  - jsp
tags:
  - [jsp, 서버사이드]

toc: true
toc_sticky: true

last_modified_at: 2022-10-12T20:00:00-05:00
---

## 배포 개요
  : 자바프로젝트를 배포하는 방법을 알아본다.

### 배포 요약
  : 순차적으로 요약하면 다음과 같다.

1. war 파일 만들기
3. 톰캣 `ContextRoot` 경로로 war파일 넣기 (톰캣이 기동되면 자동으로 폴더가 생성되어 배포된다. 단, 반드시 정상적인 파일이어야 배포된다.)
4. 톰캣 `server.xml` 내용에 docBase 등록
5. 서버기동 후 배포확인
6. 관리자계정으로 배포된 디렉토리 권한 할당


## war 파일 생성 (for 리눅스OS)
  : jar 명령어로 자바프로젝트 디렉토리를 war확장자로 압축한다.

```bash
# jar -cvf [생성할파일명].war [생성대상]

jar -cvf study.war ./webapps/study/.

```


## war 파일 압축해제 (for 리눅스OS)
  : jar 명령어로 war확장자 압축을 해제한다.

```bash
# jar -cvf [압축해제대상]

jar -xvf ~/study.war

```

## war
### 자바프로젝트 디렉토리 구성
  : 순차적으로 요약하면 다음과 같다.


```bash
# 'boom' 이라는 자바프로젝트 Directory 존재.
cd ~/boom

# 목록
ls
META-INF  hi.jsp             resources
WEB-INF   public_index.html

```

### 자바프로젝트 디렉토리 압축

```bash
# 자바프로젝트 디렉토리에서 진행
cd ~/boom

##############################
# CASE1. 압축(폴더가아닌 폴더안의 내용들을 압축)
# CASE2. 압축(폴더가아닌 폴더안의 내용들을 압축)

# 케이스별로 수행 후 문제점
# war폴더명으로 압축이풀리고 그 안에도 폴더명으로
# 생성되어있는 문제가 있다.

##############################

# 컨텍스트루트에 자동배포된 study 디렉토리 이동
cd study 

# 그 안에 같은이름으로 생성되어있다..
ls
META-INF  study

```







### 톰캣 자동배포

```bash
# 컨텍스트루트 이동
cd [톰캣경로]/webapps

# 홈에서 만든 압축을 컨텍스트루트안에 해제
jar -xvf ~/study.war


# CASE1. 해제

# 
```




## 이슈
### CASE1. war-tracker 자동배포 실패
  : 기존 아무 프로젝트를 jar명령어를 통해 war확장자로 묶어서 배포하는데 계속해서 자동배포가 안되었다.. (3시간 삽질)

> ***catalina.log***  
> java.io.IOException: 파일 [.../META-INF/war-tracker]을(를) 생성할 수 없습니다 해결


1. 원인
  : 톰캣 공식문서에서 war 파일을 확장하면, 톰캣이 실행 중이 아닐 때 war 파일의 변경을 감지하기 위해 [/META-INF/war-tracker] 파일을 추가한다고 한다. 

  - 나는 수동으로 war파일(다른프로젝트파일을 통으로 압축)을 `META-INF/war-tracker` 파일을 포함시키고 pack 했다.
  - 배포중에 tomcat은 변경 사항 감지를 위해 해당 파일(war-tracker)을 생성하려고 하지만 이미 파일이 존재하면 tomcat은 파일을 만들 수 없다며 위의 Exception을 발생시킨다.

2. 해결방안
  : war-tracker 파일을 삭제하고 다시 war를 pack한다.

  ```bash
  rm ~/study/META-INF/war-tracker

  ```

3. 해결완료
  : 다시 war 압축하고 컨택스트루트에 넣고 톰캣기동하니까 정상적으로 배포한다.


### CASE2. FTP 전송된 jsp '^M' 에러
  : FTP 으로 전달받은 war 로 배포하려고하니까 톰캣이 에러를 발생시킨다.

> ***catalina.log***  
> Caused by: java.lang.IllegalStateException: Ambiguous mapping. Cannot map 'Controller' method

1. 원인
  : FTP로 전송한 war압축 내용에서 jsp의 내용이 변조되었다. 이유는 캐리지

  - 윈도우에서 작성한 파일을 Unix/Linux상에 올리면 개행 문자가 깨져서 ^M가 보이는 경우가 있다. 
  - 이것은 윈도우에서는 CRLF 가 개행인데 Linux/Unix에서는 LF가 개행이라 나타나는 현상으로 보면 된다.

    [CR,LF 뜻]  
    라인피드(LF : Line Feed) => 현재 위치에서 바로 아래로 이동.  
    캐리지리턴(CR: Carriage return) => 커서의 위치를 앞으로 이동.  
    {: .notice--info}

2. 해결방안
  : vi, vim에서 FTP 전송중에 붙어버린 ^M 을 제거해야하면 끝이다.  

  ```bash
  vi [^M붙은JSP파일]

  # 아래 정규식으로 모두 제거
  :%s/^M//g

  ```
  
> ***주의)***  
> ^M는 ^+M 이 아니고 Ctrl + v + m 이다.







javac -cp "../../../lib/*" SessionController.java
