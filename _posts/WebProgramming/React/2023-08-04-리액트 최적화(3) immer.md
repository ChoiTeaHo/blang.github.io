---
title:  "리액트 최적화(3) immer"
excerpt: "리액트 최적화(3) immer 입니다."

categories:
  - react
tags:
  - [react]

toc: true
toc_sticky: true

last_modified_at: 2023-08-04T09:00:00-18:00:00
---

## immer 란?
> ❗***immer(이머)***  
> 💡 JavaScript에서 불변성을 유지하면서 상태를 간편하게 업데이트할 수 있도록 도와주는 라이브러리.  
> 💡 immer는 복잡한 중첩된 객체나 배열을 다룰 때 코드를 더 읽기 쉽고 유지보수하기 쉽게 만든다.  

## 불변성 재학습  
### 예제1 (불변성 지키기 기본) 

```js
const object = {
  a: 1,
  b: 2
};

object.b = 3;

```  
> ⚠️ 이렇게 직접 수정하면 안되고 !

```js
const object = {
  a: 1,
  b: 2
};

const nextObject = {
  ...object,
  b: 3
};

```
> 💡 이렇게 얕은복사로 사용해서 불면성을 지키며 새로운 객체를 만들고 수정해야한다.
  
### 예제2 (불변성 지키기 배열)  
```js
const todos = [
  {
    id: 1,
    text: '할 일 #1',
    done: true
  }}
];
const inserted = todos.concat({
  id: 3,
  text: '할 일 #3',
  done: false
});

```

> 💡 배열도 concat 을 사용해서 불면성을 지키며 새로운 객체를 만들고 수정해야한다.  
> 💡 push, splice 등의 함수를 사용하거나 n 번째 항목을 직접 수정하면 안된다.

### 예제2 (불변성 지키기 배열 심화)  
```js
const state = {
  posts: [
    {
      id: 1,
      title: '제목입니다.',
      body: '내용입니다.',
      comments: [
        {
          id: 1,
          text: '와 정말 잘 읽었습니다.'
        }
      ]
    },
    {
      id: 2,
      title: '제목입니다.',
      body: '내용입니다.',
      comments: [
        {
          id: 2,
          text: '또 다른 댓글 어쩌고 저쩌고'
        }
      ]
    }
  ],
  selectedId: 1
};

```

> 💡 위 코드에서 posts 배열 안의 id 가 1 인 post 객체를 찾아서, comments 에 새로운 댓글 객체를 추가해줘야 한다면? 

```js
// 방법1
const nextState = {
  ...state,
  posts: state.posts.map(post =>
    post.id === 1
      ? {
          ...post,
          comments: post.comments.concat({
            id: 2,
            text: '새로운 댓글'
          })
        }
      : post
  )
};

```
```js
// 방법2
const info = {
  id: 2,
  text: '새로운 댓글'
};

const nextState = {
  ...state,
  posts: state.posts.map(post =>
    post.id === 1
      ? {
          ...post,
          comments: post.comments.concat(info)
        }
      : post
  )
};

```


> 💡 위 처럼 불변성 하나 지키는데 진짜 복잡하다.  
> 💡이럴 때, immer 라는 라이브러리를 사용하면 엄청 편하게 불변성 조작이 가능하다.


## Immer 사용법
### STEP1. yarn add immer
```bash
yarn add immer

```
```js
import produce from 'immer';

```
> 💡코드의 상단에서 immer 를 위 처럼 사용한다.  
> 💡보통 produce 라는 이름으로 불러온다.  



### STEP2. 코드
```js
import produce from "immer";

const state = {
  number: 1,
  dontChangeMe: 2
};

const nextState = produce(state, draft => {
  draft.dontChangeMe += 1;
});

console.log(nextState);

```

> ❗***이머 파라미터값***  
> 1. 💡param1: 수정하고 싶은 상태  
> 2. 💡param2: 어떻게 업데이트하고 싶을지 정의하는 함수를 넣는다.  
> 3. 💡불변성 신경쓰지 않고 업데이트 가능하다. 끝.   

두번째 파라미터에 넣는 함수에서는 그냥 업데이트 해주면 다 알아서 해줍니다.
