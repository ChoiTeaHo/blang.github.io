---
title:  "MariaDB 구축"
excerpt: "MariaDB를 구축한다."
categories:
  - web-service-dev
tags:
  - [web, dev, mariaDB]
toc: true
toc_sticky: true
last_modified_at: 2022-10-24T20:00:00-05:00
---
# MariaDB

## 마리아DB(MariaDB) 이란?
생략...
<br>

## 마리아DB(MairaDB)  vs 오라클 차이점
[참고블로그 이동](https://m.blog.naver.com/gozun/222521083476)


# MariaDB 구축

## MariaDB  설치
: apt-get 명령어로 설치를 진행한다.

1. 패키지 업데이트 선행
```bash
sudo apt-get update
sudo apt-get upgrade
```

2. apt-get 명령어로 설치

```bash
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install mariadb-server 
```

3. 설치 완료 


4. 정상 테스트 

```bash
//mariaDB 서비스 시작 명령어
$ service mariadb start

//mariaDB 상태확인
ps -ef | grep mysql
netstat -antp - grep mysql

//mariaDB 시작 명령어
//mysql -u [유저명]
$ mysql -u root -p


//mysql  이라는 데이터베이스의 root 계정 비밀번호 셋팅을 확인!
MariaDB [(none)]> select user, host, password from mysql.user;
```
<br>

## MariaDB 보안 초기설정
: 설치가 완료된 후에는 다음 명령어를 사용하여 DB의 root 패스워드 및 각종 보안 설정을 해준다.

```bash
$ sudo mysql_secure_installation 
```


#설정 1 : Set root password? [Y/n] y ⇒ DB의 root #초기 패스워드를 설정합니다. 기본적으로 설치시에는 #DB의 패스워드가 없기때문에 y를 눌러서 무조건 #설정해줍시다
#		
#설정 2 : Remove anonymous users? [Y/n] y ⇒ #익명 사용자를 제거합니다. 보안상 y 해줍시다
#		
#설정 3 : Disallow root login remotely? [Y/n] n #⇒ 원격 제어 여부입니다. 우리는 원격 제어를 위해 n #을 해줍니다
#		
#설정 4 : Remove test database and access to it? #[Y/n] y ⇒ 초기 테스트 DB 삭제 여부입니다. 사용을 #할꺼면 n 아니면 y 을 해줍시다. 저는 제가 만들어서 #테스트 할꺼라서...삭제!!
#		
#설정 5 : Reload privilege tables now? [Y/n] y ⇒ #DB reload 를 통한 지금까지의 설정 저장 여부입니다. #당연히 y!!
```  

## MariaDB 외부접속허용처리 초기설정
: 애플리케이션 서버와 디비 인스턴스를 분리하면서, 
원격으로 DB에 커넥션 연결을 요청해야했다.
그렇게 하기 위해서는 DB 인스턴스에 mysql을 설치하고, 
mysql.cnf 파일에서 보안 그룹에 알맞은 port와 
bind-address를 설정해주어야한다.  

- 바인드
  > bind-address란?   
  > 데이터베이스 서버가 어떤 주소로의 요청을 
  > 허용할 것인지 설정하는 것이다. 그래서 
  > 0.0.0.0/0을 설정하게 되면 네트워크 전체 대역, 
  > 즉 모든 트래픽에 대해서 요청을 허용한다 뜻이기에 
  > 문제없이 원격 커넥션이 이루어진다. 

```bash
//50-server.cnf 파일 열기.
$ sudo vi /etc/mysql/mariadb.conf.d/50-server.cnf

//내용중 아래 라인을 주석처리.
bind-address = 127.0.0.1
     // AS-IS
#bind-address = 127.0.0.1   // TO-BE

//서버 재기동으로 적용
$ sudo service mysql restart
```
<br>

## MariaDB 방화벽처리
: MariaDB 기본 포트(3306)를 허용한다.

```bash
// 방화벽(3306 TCP포트) 허용
$ ufw allow 3306/tcp

//서버 재기동으로 적용
$ sudo service mysql restart
```
<br>

## MariaDB 사용자 계정 생성
: 사용자 계정을 생성 + 권한부여

```mysql

//사용자 생성
//create user '사용자'@'IP' identified by '비밀번호';
//  사용자 : 사용자 아이디 입력
//  IP : 접근을 허용할 IP 입력 
//      -(case1). localhost(로컬 접속),
//      -(case2). 1.2.3.4(1,2,3,4 IP만 허용)
//      -(case3). 1.2.3.%(1,2,3 번대 IP 허용)
//      -(case4). %(모든 IP 허용)
//  비밀번호 : 사용자 비밀번호 입력 

MariaDB [(none)]>  
create user 'INSTC'@'%' identified by 'a';

// 생성한 계정으로 db 접속
$ mysql -u INSTC -p;
Enter password: [패스워드 입력]
```
<br>
<br>

## MariaDB 권한

### MariaDB 권한조회
: 권한을 조회하는 방법

```mysql

// 기본권한 조회
// select * from mysql.user where user = [사용자ID]

// 기본권한조회 (원격접속권한보기)
// 초기설치에는 root계정 1개이며 localhost  만 접속할 수 있음
// SELECT Host,User,authentication_string FROM mysql.user;

// 사용자권한 조회
// SHOW GRANTS FOR '사용자계정'@'호스트';

// 사용자별 권한 확인
// SHOW GRANTS FOR '사용자계정'@'호스트';

// 접속된 계정 권한 확인
// SHOW GRANTS FOR CURRENT_USER;

```
<br>

### MariaDB 계정별 권한추가
: 생성한 사용자 계정에게 권한을 부여하는 방법

```mysql

// 등록된 사용자에게 권한추가하기

// DB, 테이블, 원격접속IP 권한추가 방법
//  IP : IP부분에는 접근을 허용할 IP 입력 
//      -(case1). localhost(로컬 접속),
//      -(case2). 1.2.3.4(1,2,3,4 IP만 허용)
//      -(case3). 1.2.3.%(1,2,3 대역대 IP 허용)
//      -(case4). %(모든 IP 허용)

// (유형1). 특정DB(특정테이블)에 대해 권한허용
// grant all privileges on DB이름.테이블 to '계정아이디'@'접속위치';

// (유형2). 특정DB(전체 테이블)에 대해 권한허용
// grant all privileges on DB이름.* to '사용자'@'IP';

// (유형3). 전체 DB(전체 테이블에)에 대한 권한허용
// grant all privileges on *.* to '사용자'@'IP';

MariaDB [(none)]> grant all privileges on *.* to INSTC@'%';


// DML 권한추가 방법
// (유형4) 특정 데이터베이스의 특정 테이블에 select 권한허용
// grant select on DB이름.테이블명 to '사용자'@'localhost';
	
	// (유형5) 특정 데이터베이스의 특정 테이블에 select, insert 권한허용
// grant select, insert on DB이름.테이블명 to '사용자'@'localhost';
	
// (유형6) 특정 데이터베이스의 특정 테이블의 컬럼1과 컬럼2의 update 권한허용
// grant update(컬럼1, 컬럼2) on DB이름.테이블명 to '사용자'@'localhost';

	
// (별첨)원상복구

//방법1
MariaDB [(none)]> DELETE FROM mysql.user WHERE Host='%' AND User='root'; 
MariaDB [(none)]> FLUSH PRIVILEGES;

//방법2
revoke all on DB이름.테이블명 from userid@host


```


flush privileges  명령어  
: DML 권한추가시 필수 명령어  
INSERT나 UPDATE, DELETE문을 이용해서 MySQL의 사용자를 추가,삭제하거나,  사용자 권한 등을 변경하였을 때, MySQL에 변경사항을 적용하기 위해서 사용하는 명령어 flush privileges 는 정확히 말하면 grant 테이블을 reload 함으로 변경사항을 바로 적용해주는 명령어인데, INSERT, UPDATE와 같은 SQL문이 아닌 grant 명령어를 사용해서 사용자를 추가하거나 권한등을 변경하였다면 굳이 실행할 필요가 없음.
{: .notice–info}




<br>
<br><br>
<br>
<br>
<br><br><br>
___
### MariaDB 계정별 원격접속권한 부여
: mysql 계정별로 원격접속 권한을 줘야한다.


	grant all privileges on DB이름.테이블 to '계정아이디'@'접속위치';

모든 ip 허용
INSERT INTO mysql.user (host,user,authentication_string,ssl_cipher, x509_issuer, x509_subject) VALUES ('%','root',password('패스워드'),'','',''); 
		
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%'; FLUSH PRIVILEGES;


IP 대역 허용 ( ex : 111.222.xxx.xxx )
INSERT INTO mysql.user (host,user,authentication_string,ssl_cipher, x509_issuer, x509_subject) VALUES ('111.222.%','root',password('패스워드'),'','','');
		
GRANT ALL PRIVILEGES ON *.* TO 'root'@'111.222.%'; FLUSH PRIVILEGES;
		
		○ 특정 IP허용
		INSERT INTO mysql.user (host,user,authentication_string,ssl_cipher, x509_issuer, x509_subject) VALUES ('111.222.33.44','root',password('패스워드'),'','',''); 
		
		GRANT ALL PRIVILEGES ON *.* TO 'root'@'111.222.33.44'; FLUSH PRIVILEGES;
		
		○ 원상복구
		DELETE FROM mysql.user WHERE Host='%' AND User='root'; FLUSH PRIVILEGES;



```


