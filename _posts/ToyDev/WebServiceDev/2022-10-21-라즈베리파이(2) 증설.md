---
title:  "라즈베리파이(2) 증설"
excerpt: "라즈베리파이(2) 증설입니다."
categories:
  - web-service-dev
tags:
  - [web, dev]
toc: true
toc_sticky: true

last_modified_at: 2022-10-12T20:00:00-05:00
---

# 라즈베리파이 증설
## 증설 개요
  : 실제 물리적 서버를 분리, 구축하여 이중화, 클러스터링 등의 기술을 적용한 환경을 혼자서 구성하고 여기에 작동되는 Spirng 프레임워크 기반의 웹사이트를 만들고 싶었다. (인프라는 대부분 이미 구축되어있기때문에... 내가 개발에 투입되면 이 서버가 어떻게 서버간 효율적인 프로세스를 가지고 자원공유를 하는지 궁금했다. ) 이러한 이유로 저렴한 라즈베리파이를 추가증설 하기로 하였으며, 마침 중고거래사이트에서 좋은 구성의 매물이 나왔다.



## 라즈베리파이 증설 제품
  : 다음과 같은 제품이 매물로 나왔다.  

    - ​라즈베리파이4 4GB * 3
    - 삼성 64GB (TLC) * 3
    - POE HAT * 3
    - 타워케이스
    - POE 허브 IPTIME 4포트
    

### 라즈베리파이4 4GB
  : 기존 구매한 라즈베리파이와 동일한 4모델이지만 메모리용량이 더작은 4GB 이다.
  
### 삼성 64GB (TLC)
  : 각 라즈베리파이에 기본적으로 넉넉한 용량의 sd메모리카드도 포함되어있었다. 상대적으로 안전한 MLC지만 중고라서 언제 고장날지 불안하다.

### POE HAT
  :  PoE Hat 이란 라즈베리파이가 PoE 기능을 사용할 수 있도록 도와주는 추가 장비이다.(구매직전 이 제품이 뭔지 몰라서 찾아보았고 나한테 필요한 네트워크 장비라는걸 알게되었다.) PoE 장비의 기본적인 구성 개념은 `인젝터`, `스플리터` 가 필수이다.

    ```bash
    # 판매자님께 답변받은 PoE HAT의 기능
    Power Over Ethernet 약자로 랜선을 통해 전원을 공급 받습니다.
    POE는 인젝터(전원공급장치)와 스플리터 두개가 있어야 하는데 구성품의 POE HAT이 스플리터이고,
    POE인젝터 장비는 별도로 구매 하시거나 게시글에 같이 판매하고 있는 POE 허브를 구매하셔서 사용하면됩니다.
    POE모듈이 GPIO단자를 사용하고 있으니 그점도 참고부탁드립니다.
    ```

    * 스플린터
      - 랜선으로 전력을 넣어주며 불필요한 전원 어댑터를 최소화 할 수 있는 장비이다. 예를들어 물리적인 서버 수 만큼 장비도 늘어나고 해당 장비에 모두 전원을 인가해줘야 할것이다. (전원 콘센트가 각 장비마다 필요하므로 어댑터 코드가 많이 필요하면 콘센트를 많이잡아먹는다..) 이 PoE 개념의 장비가 있으면 복잡한 선없이 간소화된 랜선하나로 여러 PoE장비에 전원을 인가한다. 그런데 PoE를  사용하기

    * PoE Hat 연결
      - 추가장비인 PoE Hat을 연결하기 위해선 GPIO 핀에 스플리터 기능을 지원하는 기계를 장착해서 사용하면된다.



3. OS 정상설치 확인
  : 정상적으로 작동하는지 확인한다.
: 1￦. SD카드를 라즈베리파이 보드에 삽입  
: 2￦. ~~라즈베리파이 보드에 붙은 HDMI 포트로 모니터 연결, 키보드 연결~~  
: 2￦. 라즈베리파이 SSH 접속방식으로 진행  
: 3￦. 라즈베리파이에 전원 인가(Power On)  
: 4￦. Raspberry OS의 쉘에 정상적으로 연결되는지 확인  

### 라즈비안OS SSH 접속방식
  : 라즈베리파이에 모니터, 키보드 없이 ssh로 접속하도록 한다.

1. ssh 클라이언트 설치
  : 접속하려는 컴퓨터에 ssh 클라이언트를 설치한다. ex) 윈도우기본ssh, mobaXterm, putty

2. SSH 파일작성
  : 파일만 작성해두면 부팅시 SSH는 ON상태가 된다.
    - /sd카드루트/ssh 라는 명칭으로 빈파일 생성

3. 무선랜 설정(선택)
  : 부팅시 무선랜을 잡아준다. 유선랜을 사용하는경우 건너뛰어도 상관없다.~~
    - /sd카드루트/wpa_supplicant.conf 파일 생성
    ```bash
      ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdevupdate_config=1
      network={
      ssid="U+NetA940_5G" //무선랜id
      psk="999999" //무선랜pw
      }  
    ```

3. 유선랜설정(선택)
  : 유선랜을 연결.

4. 연결된 라즈베리파이장비 IP 확인
  : 무선랜 또는 유선랜 설정한뒤 쉘에 접속하기 위해 IP를 확인한다. 그리고 cmd에서 ping을 날려본다.
    * 방법1. 공유기 제조업체 콘솔에서 확인 (iptime기준 [네부네트워크]탭 확인)
    * 방법2. ping raspberrypi.local
    * 방법3. 별도 유틸리티로 확인(Advanced IP Scanner)

5. 접속

## 초기셋팅
: 아래 내용 설정 후 재부팅하여 적용한다.
### 계정 비밀번호 변경
  : 계정 암호를 변경
  ```bash
  
  #방법1
  pi@cddadbo1:/# sudo passwd pi  #pi계정
  pi@cddadbo1:/# sudo passwd  #root계정

  #방법2
  pi@cddadbo1:/# raspi-config
 
  # 순서대로 아래 내용 선택
  # System Options > S3 Password
  New password:  #변경패스워드 입력

  ```

### 표준시간대 변경
  : 서울 기준의 표준 시간을 설정한다.
  ```bash
  root@cddadbo1:/# raspi-config
  
  # 순서대로 아래 내용 선택
  # Localisation Option > TimeZone > Asia 선택 > s한번누르고 Seoul 선택

  ```

### SD카드 전체공간 사용허가 설정
  : 초기 SD카드는 전체공간을 사용할 수 없으므로 풀어준다. (특정크기 파티션으로 구성된 이미지 파일을가지고  Micro SD카드에 라이팅했기 때문이라고 한다..)
  
  ```bash
  # 순서대로 아래 내용 선택
  Advanced Options >  Expand Filesystem > 재부팅 후 적용

  ```

### vi에디터 방향키이슈 설정
  : 라즈비안OS에서 방향키가 안먹히는 이슈가 존재한다. 방향키 누르면 [^A, B, C, D 가 나오거나, 백스페이스 누르면 글자 안지워진다.(21/09/07 기준)
  ```bash
  # vim을 설치해서 사용해도 되지만 해당 이슈는 우분투에서 발생하며 vi 에디터 옵션을 바꿔야한다.
  # .exrc 신규파일 작성 후 저장
  root@cddadbo1:/# vi /etc/skel/.exrc  #꼭 skel 안에 작성하자. 계정을 생성하면 홈디렉토리에 기본적으로 생성되는 파일로 설정한다.

  set bs=2
  set nocp

  ```

### 폰트와 키보드입력기 설치
  : 폰트와 키보드 입력기를 설치한다
  ```bash
  pi@cddadbo1:/# sudo apt-get install fonts-unfonts- core
  pi@cddadbo1:/# sudo apt-get install ibus
  pi@cddadbo1:/# sudo apt-get install ibus-hangul
  pi@cddadbo1:/# ibus engine hangul

  ```

### API 업데이트
  : 기본API를 모두 업데이트한다.
  ```bash
  pi@cddadbo1:/# sudo apt-get update & sudo apt-get upgrade -y
  pi@cddadbo1:/# sudo apt-get full-upgrade
  pi@cddadbo1:/# sudo rpi-update -y
  pi@cddadbo1:/# sudo reboot

  ```

### (작성중)
  : 새로운 이슈 주기적으로 갱신중
