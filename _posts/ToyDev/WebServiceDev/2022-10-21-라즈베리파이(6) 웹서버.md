---
title:  "라즈베리파이(6) 웹서버 구축"
excerpt: "라즈베리파이(6) 웹서버 구축 입니다."
categories:
  - web-service-dev
tags:
  - [web, dev]
toc: true
toc_sticky: true

last_modified_at: 2022-10-12T20:00:00-05:00
---

# 라즈베리파이 웹서버
## 웹서버 구축 개요
  : 라즈베리파이에 웹서버를 구축한다. 웹서버 제품은 대중적인 `Apache` 으로 결정했다.

### 자동설치와 수동설치
  : `자동설치` 와 `수동설치` 모두 테스트해보았는데 웹서버를 원하는 경로에 설치하고싶어서 `수동설치` 를 메인으로 진행한다.

  - 자동설치란?
    : 흔히 apt-get 명령어등으로 패키지를 쉽게 제공하는 명령어

  - 수동설치란?
    : 소스설치, 수동설치, 컴파일설치: linux에서 소스를 직접 다운받아 컴파일하여 설치하는 것을 말한다.

### 수동설치의 상세 목적  
  : 패키지 설치로 간편하게 설치를 할 수 있지만 불필요하게 설치되는 파일들이 시스템의 자원을 사용하게 되고 패키지 단위로 설치되기에 관리적으로 문제가 발생 가능하다.

  - 원하는 경로에 설치하고 싶을때
    : 수동설치로 폴더링하여 web, was 제품을 한곳에서 특정관리자가 관리하고 싶다.
  - 급격하게 최신버전의 패키징설치가 필요한경우 apt-get 명령어처럼 자동설치에 최신버전 갱신이 필요할때  
    : 최신소스파일을 반입해서 수동설치하는 방법이 필요할 것이다.
  - 외부망이 안되는 환경에서 apt-get 또는 wget 명령어를 못쓸때  
    : 소스파일을 반입해서 수동설치하는 방법이 필요할 것이다. 
  - 실제 업무환경에서 보안상이유로 자동설치 비권장  
    : 헤더정보를 감추기위해

### 설치 소스경로 관례  
  : 패키지 설치시 여러 소스들이 설치되는 경로에대해 관례가 존재한다.

  - 소스설치는 /usr/local 에 설치하는것이 관례이다.  
  - 소스파일은 /usr/local/src 에 보관한다.  
  - 컴파일 설정을 마친 후에는 아래 명령어로 설치를 수행한다.  

  ```bash
  # 기본적인 소스 컴파일방식 설치방법은 다음과 같다.

  미리 소스파일준비        # 공홈에서 패키지소스를 다운받고 서버에 올려둔다.
  /configure           # 소스 구성이다. 소스파일에 대한 환경설정을 해주는 명령어다. (뒤에 옵션을 넣음) 서버환경에 맞추어 makefile을 생성해주는 과정이다.
  /configure --prefix  # prefix가 있으면 경로를 지정할 수 있다.
  make                 # 소스컴파일이다. 소스를 컴파일 하는 것이다. 컴파일이란 소스파일을 사용자가 실행 가능한 파일로 만들어 주는 과정을 말한다.
  make install         # 설치한다. make를 통해 만들어진 설치파일을 설치하는 과정이다. 한마디로 build된 프로그램을 실행할 수 있게 파일들을 알맞은 위치에다가 복사를 한다.
  
  ```

### 웹서버 수동설치 (소스컴파일 방식)
  : 소스컴파일방식의 수동설치를 진행한다. 참고로 순서가 보장되어야한다.

* apr -> util -> pcre -> 아파치 순으로 설치  

참고) 아파치 소스설치 주의사항  
앞으로 httpd-2.4.X 버전부터는 apr과 apr-util, pcre 라는 의존성 패키지를 별도로 설치하여야 apache 설치가 완료된다고 한다.
{: .notice--info }
  

1. 선행 컴파일 관련 패키지를 설치
  : 컴파일 관련하여 아래 패키지들이 필수라고 한다. 아래 명령어로 설치한다.

    ```bash
    sudo apt-get update && sudo apt-get upgrade  #패키지 업데이트 선행

    apt-get install gcc
    apt-get install libexpat1-dev
    apt-get install g++
    apt-get install libexpat-dev

    ```

2. 아파치 수동설치 경로 정하기
  : 아파치 설치경로를 원하는곳으로 정한다.

    ```bash 
    mkdir /fswas/install  # 다운받은 원본 패키지를 넣는 공간
    mkdir /fswas/apache   # 아파치를 최종으로 설치할공간
    mkdir /fswas/apache/apr       # 아파치 의존성패키지 설치할 공간
    mkdir /fswas/apache/apr-util  # 아파치 의존성패키지 설치할 공간
    mkdir /fswas/apache/pcre      # 아파치 의존성패키지 설치할 공간

    ```

3. 소스파일 다운로드
  : 아래 링크의 공식홈페이지에서 아파치와 아파치에 필요한 의존성 패키지 소스를 다운로드한다. (apache를 ubuntu에 설치 및 실행하기 위해서는 APR, PCRE와 같은 의존성 패키지를 설치해야 한다.) 

    |이미지파일|공식홈페이지|설명|
    |------|---|---|
    |Apr, Apr-util|[다운로드 링크](https://apr.apache.org)|의존성패키지|
    |Pcre|[다운로드 링크](http://www.pcre.org)|의존성패키지|
    |Apache|[다운로드 링크](http://www.apache.org/dyn/closer.cgi)|아파치웹서버소스|

![링크](https://apr.apache.org)

4. 소스파일 압축해제
  : 각각의 폴더에 압축을 풀어준다 (* 추가로 심볼릭링크로 마지막버전임을 관리차원에서 걸어주었다.)

    ```bash 
    /fswas/apache/apr# tar -zxf apr-1.7.0.tar.gz
    sudo ln -s /fswas/apache/apr/apr-1.7.0 lastver

    /fswas/apache/apr-util# tar -zxf apr-util-1.6.1.tar.gz
    sudo ln -s /fswas/apache/apr-util/apr-util-1.6.1 lastver

    /fswas/apache/pcre# tar -zxvf  pcre2-10.40.tar.gz
    sudo ln -s /fswas/apache/pcre/pcre2-10.40 lastver

    /fswas/apache# tar xvfz httpd-2.4.51.tar.gz
    sudo ln -s /fswas/apache/httpd-2.4.54/ lastver

    ```


5. 설치
  : 이제 설치를 위한 준비가 끝났다. 설치를 진행한다.

  - Apr



    
## 호스트네임 관련 이슈
  : 이슈를 기록한다.

A. 계정추가시 호스트네임 더미관련 에러
  : 계정을 새롭게 추가하는 과정에서 `sudo: unable to resolve host ... ...` 에러가 출력했다. 이는 `/etc/hostname` 과 `/etc/hosts` 에 저장된 hostname 이 달라서 발생한 이슈로 확인되었다.
  
  1. `/etc/hostname` 안에 호스트네임 변경
  2. `/etc/hosts` 안에 호스트네임 변경
  3. 해결
