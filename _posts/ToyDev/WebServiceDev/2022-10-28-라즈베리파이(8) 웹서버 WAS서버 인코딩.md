---
title:  "라즈베리파이(8) 웹서버 WAS서버 인코딩"
excerpt: "라즈베리파이(8) 웹서버 WAS서버 인코딩"
categories:
  - web-service-dev
tags:
  - [web, dev]
toc: true
toc_sticky: true

last_modified_at: 2022-10-28T20:00:00-05:00
---

## 인코딩 기본 개념  
> ❗<span style="color:green"><I><b>인코딩은 동일해야한다</b></I></span>  
> 💡 `파일인코딩` 과 `서버인코딩` 이 동일해야한다.   
>    
> ❗<span style="color:green"><I><b>조치방법</b></I></span>  
> 💡 <b>문제가 발생하면 현재 인코딩을 파악해본다.</b>   
>   1. <span style="color:red"><I><b>시스템 레벨의 인코딩을 확인</b></I></span>  
>  
>       - ```
>         시스템 레벨의 인코딩을 확인하는 이유는 혼동을 방지하기 위해서다.
>         실제로 로그 파일의 인코딩이 깨지면 어디가 문제인지 파악할때 
>         서버와 파일인코딩은 정상인데, 이 문제를 몰라서
>         문제를 못찾는 경우가 많기 때문이다.
>  
>         요약하면 시스템레벨과 서버레벨의 인코딩은 별개지만
>         서버측으로 부터 파일처리가 존재하면 인코딩이 꼬일 수 있다.
>         ```
>  
>   2. <span style="color:red"><I><b>서버 인코딩을 확인</b></I></span>  
>       - ```
>         WEB서버의 서버 인코딩이 설정파일에 없다면 클라이언트(브라우저)설정으로 결정된다.
>         WAS서버의 서버 인코딩이 설정파일에 없다면 서블릿 컨테이너의 내부로직으로 ISO-8859-1 가 설정된다.
>         ```
>   
>   3. <span style="color:red"><I><b>파일 인코딩을 확인</b></I></span>  



## 시스템레벨 인코딩
### STEP1. 시스템 레벨 인코딩을 확인
```bash
# 서버인코딩 확인(1)
wasadm@cddawso1:/ $ echo $LANG
en_GB.UTF-8

# 서버인코딩 확인(2)
wasadm@cddawso1:/ $ locale
LANG=en_GB.UTF-8

```

> ❗<span style="color:green"><I><b>en_GB.UTF-8 인코딩</b></I></span>  
> 💡 한글 출력이 불가능한 (영어,영국) en_GB.UTF-8 인코딩이다.  
> 💡 시스템레벨 인코딩이 apache web 서버 동작에 영향이 가지는 않지만,   
> 💡 향후 서버인코딩이 문제아가 될 수 있다! 정도를 인지할 수 있다.  

### STEP2. 시스템 레벨 인코딩을 변경  
```bash
# 1. 로케일 재설치 명령어 수행
wasadm@cddawso1:/ $ apt-get install --reinstall locales && sudo dpkg-reconfigure locales
wasadm@cddawso1:/ $ install --reinstall  # 재설치
wasadm@cddawso1:/ $ dpkg-reconfigure     # 이미 설치된 패키지를 재설정한다.


# 2. GUI가 나오면 `ko.KR.UTF-8 UTF-8` 을 선택

# 3. 저장

```

> ❗<span style="color:green"><I><b>KR.UTF-8</b></I></span>  
> 💡 시스템에 관련된 (문서편집 등) 모든 것들을 한글로 출력하기 위해 `KR.UTF-8` 으로 변경했다.


## 서버 레벨 인코딩
### 문제점  
> 💡 현재 아파치 웹서버의 기본 index,html 문서를 크롬으로 접속하니까 한글이 깨진다.   

### STEP1. 서버인코딩을 확인
```bash  
wasadm@cddawso1:/ $ vi [httpd-X.X.XXX)]/conf/httpd.conf

```

```bash
# CASE1. (설치시 기본) 아예 존재하지 않거나 아래처럼 OFF
AddDefaultCharset off

# CASE2. 웹서버 기본 인코딩 지정 UTF-8, EUC-KR 등.
AddDefaultCharset UTF-8

```

> ❗<span style="color:green"><I><b>AddDefaultCharset 는 기본적으로 없다.</b></I></span>  
> 💡 웹 서버(Apache) 인코딩을 확인하는 모습이다.  
> 💡 기본패키지에서 AddDefaultCharset 설정자체가 없었다.  
> 💡 기본패키지에서 다양한 처리를 유연하게 하기위해 아파치재단의 목적으로 보인다.  


### STEP2. 서버 인코딩을 변경  

✅ <span style="color:red"><I><b>AddDefaultCharset 없는 경우</b></I></span>  

```bash
# CASE1. 캐릭셋이 없다. 브라우저에서 결정한다.
curl -s -I http://www.blang.co.kr/jktest/jktest.html
HTTP/1.1 200 OK
Date: Tue, 15 Aug 2023 06:34:25 GMT
Server: Apache/2.4.54 (Unix) OpenSSL/1.1.1n mod_jk/1.2.48
Last-Modified: Mon, 05 Dec 2022 04:19:40 GMT
ETag: "39-5ef0cfefc07ca"
Accept-Ranges: bytes
Content-Length: 57
Content-Type: text/html # 캐릭셋 없음

```

✅ <span style="color:red"><I><b>AddDefaultCharset UTF-8 인 경우</b></I></span>  

```bash
# CASE1. 고정적인 캐릭셋이 생겼다.
curl -s -I http://www.blang.co.kr/jktest/jktest.html

HTTP/1.1 200 OK
Date: Tue, 15 Aug 2023 06:30:59 GMT
Server: Apache/2.4.54 (Unix) OpenSSL/1.1.1n mod_jk/1.2.48
Last-Modified: Mon, 05 Dec 2022 04:19:40 GMT
ETag: "39-5ef0cfefc07ca"
Accept-Ranges: bytes
Content-Length: 57
Content-Type: text/html; charset=EUC-KR  # 캐릭셋 정상설정 확인

```

[사진1](/assets/images/ToyDev/WebServiceDev/web_encoding_all_1.jpg)

> ❗<span style="color:green"><I><b>변경 후 모습</b></I></span>  
> 💡 웹 서버(Apache) 인코딩을 확인하는 모습이다.  
> 💡 기본패키지에서 AddDefaultCharset 설정자체가 없었다.  
> 💡 기본패키지에서 다양한 처리를 유연하게 하기위해 아파치재단의 목적으로 보인다.

기본 캐릭터셋을 utf8 로 고정해준다. 서버에서 다른짓하고 특정 캐릭터셋만 사용시에는 나쁘지 않을꺼 같지만. 나처럼 개발개발 서버에서는 필요없음

AddDefaultCharset off






### STEP3. 파일인코딩을 확인
```bash
# 파일인코딩 확인  
wasadm@cddawso1:/$ file -bi /fswas/apache/httpd/httpd-2.4.541/htdocs/index.html 
text/html; charset=utf-8

```

> ❗<span style="color:green"><I><b>text/html; charset=utf-8</b></I></span>  
> 💡 파일의 인코딩을 서버와 동일한지 확인했다.  
> 💡 서버와 동일한 utf-8 이므로 정상이다.  
> 💡 한글 출력이 가능해진다.  


### 해결완료
> ❗<span style="color:green"><I><b>웹서버에 접속해보면 한글이 정상적으로 출력함을 알 수있다.</b></I></span>  


## 라즈베리파이 와스서버 한글깨짐  
### 문제점  
> 💡 아파치 톰캣(WAS)서버의 기본 index,html 문서를 크롬으로 접속하니까 한글이 깨진다.   


### STEP1. 서버인코딩을 확인

<span style="color:red"><I><b>WAS 서버의 설정 방법은 조금 다양하다.</b></I></span>    
{: .notice--info}
  
1.  sever.xml 방법
```bash
# 사용중인 톰캣 설정을 수정
vi [apache-tomcat-X.X.XX)]/conf/server.xml 

```

<Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" 


2. dd
```bash
# 서버인코딩 확인(1)
wasadm@cddawso1:/ $ echo $LANG
en_GB.UTF-8

# 서버인코딩 확인(2)
wasadm@cddawso1:/ $ locale
LANG=en_GB.UTF-8

```
