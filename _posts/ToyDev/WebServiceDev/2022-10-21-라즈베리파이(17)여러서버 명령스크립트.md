---
title:  "라즈베리파이(17) 여러서버 명령스크립트"
excerpt: "라즈베리파이(17) 여러서버 명령스크립트 입니다."
categories:
  - web-service-dev
tags:
  - [web, dev]
toc: true
toc_sticky: true

last_modified_at: 2022-10-12T20:00:00-05:00
---

# 라즈베리파이 여러서버 명령스크립트
## ssh 개요
  : 라즈베리파이에 구축한 Apache 1대 & Tomcat 2대 서버로 한번에 명령어를 수행한다.

> ***ssh 명령어***  
> 다른 서버로 붙을 수 있는 명령어.  
> 현재 나도 스마트폰 ssh로 각 서버에 붙어서 작업하고 있으며, 이번에는 스마트폰을 통해 붙은 리눅스 안에서 다시 ssh 명령어를 수행하는 차이일뿐 기능의 본질은 똑같다. 

/sshd
{: .notice--info}


## ssh 스크립트
  : 여러 서버에 ssh 명령어를 나열한 스크립트를 생성한다.

### WEB서버
  : 여러 서버를 핸들링할 서버에서 스크립트 생성. 나는 web서버로 결정했기에 아래처럼 작성한다.

  ```bash
  # 여러서버들을 핸들하고싶은 특정서버에다가 생성
  vi ~/script/dbd/server_hostname.sh
  
  #!/bin/bash
  echo "웹1.... >>>"  
  sudo ssh 웹서버계정@blang.co.kr -p [웹서버포트] sudo hostname -I  

  echo "와스1.... >>>"  
  sudo ssh 와스서버1계정@blang.co.kr -p [와스1서버포트] sudo hostname -I  

  echo "와스2.... >>>"  
  sudo ssh 와스서버2계정@blang.co.kr -p [와스2서버포트] sudo hostname -I  

  ```

### WAS 서버1
  : WEB 서버에서 핸들링당하는 WAS1 서버이다. 실행하는 계정에 sudo 명령어 권한을 부여한다.

  ```bash
  sudo vi /etc/sudoers

  # User privilege specification
  root        ALL=(ALL:ALL) ALL
  WAS1서버계정  ALL=(ALL:ALL) ALL  #권한부여 추가

  ```

### WAS서버2
  : WEB 서버에서 핸들링당하는 WAS2 서버이다. 실행하는 계정에 sudo 명령어 권한을 부여한다.

  ```bash
  sudo vi /etc/sudoers

  # User privilege specification
  root        ALL=(ALL:ALL) ALL
  WAS2서버계정  ALL=(ALL:ALL) ALL  #권한부여 추가

  ```

## 테스트
  : 위와 같이 만들고 테스트해보면 에러가 발생한다.
  
  ```bash
  sh ~/script/dbd/server_hostname.sh
  
  sudo: 존재하는 tty가 없으며 askpass 프로그램을 지정하지 않았습니다

  # 에러가 발생했다.
  # /etc/sudoers에 해당 계정의 권한을 설정했음에도, 아래와 같은 로그를 남기며 명령어 수행을 실패하는 경우가 있다.

  ```

### 원인과 해결  
  : 해당 원인을 분석한 결과.. cron 이나 agent 내부에서 sudo 명령어 실행이 불가능하며, 실제 tty(teletyperwriter, Linux 콘솔 or 터미널) 를 통해 접속된 상태에서만 sudo 명령어 실행이 가능한것같다. 각 서버의 관리자계정에게 sudo 권한을 암호없이 사용하도록 변경한다.  

  ```bash
  sudo vi /etc/sudoers  

  # ASIS
  # [각서버계정]  ALL=(ALL:ALL) ALL  #주석처리
  
  # TOBE
  # 각각의 서버에 이부분 NOPASSWD 처리하면 된다.
  [각서버계정]  ALL=(ALL) NOPASSWD: ALL 

  ```

참고) https://forum.ubuntu-kr.org/viewtopic.php?t=26144

### ssh권한 적용완료

> 완료
