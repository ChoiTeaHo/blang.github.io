---
title:  "라즈베리파이(17) 여러서버 명령스크립트"
excerpt: "라즈베리파이(17) 여러서버 명령스크립트 입니다."
categories:
  - web-service-dev
tags:
  - [web, dev]
toc: true
toc_sticky: true

last_modified_at: 2022-10-12T20:00:00-05:00
---

# 라즈베리파이 여러서버 명령스크립트
## ssh 개요
  : 라즈베리파이에 구축한 Apache 1대 & Tomcat 2대 서버로 한번에 명령어를 수행한다.

> ***ssh 명령어***  
> 다른 서버로 붙을 수 있는 명령어.  
> 현재 나도 스마트폰 ssh로 각 서버에 붙어서 작업하고 있으며, 이번에는 스마트폰을 통해 붙은 리눅스 안에서 다시 ssh 명령어를 수행하는 차이일뿐 기능의 본질은 똑같다. 

/sshd
{: .notice--info}


## ssh 스크립트
  : 여러 서버에 ssh 명령어를 나열한 스크립트를 생성한다.

### WEB서버
  : 여러 서버를 핸들링할 서버에서 스크립트 생성. 나는 web서버로 결정했기에 아래처럼 작성한다.

  ```bash
  # 여러서버들을 핸들하고싶은 특정서버에다가 생성
  vi ~/script/dbd/server_hostname.sh
  
  #!/bin/bash
  echo "웹1.... >>>"  
  sudo ssh wasadm@blang.co.kr -p [웹서버포트] sudo hostname -I  

  echo "와스2.... >>>"  
  sudo ssh wasadm@blang.co.kr -p [와스1서버포트] sudo hostname -I  

  echo "와스1.... >>>"  
  sudo ssh dbd000@blang.co.kr -p [와스2서버포트] sudo hostname -I  

  ```

### WAS서버1
  : WEB 서버에서 핸들링당하는 WAS1 서버이다. 

  1. ssh 권한부여
  2. 목적에 맞는 스크립트 생성.

  ```bash
  sudo vi /etc/sudoers

  # User privilege specification
  root        ALL=(ALL:ALL) ALL
  WAS1서버계정  ALL=(ALL:ALL) ALL  #권한부여 추가

  ```

### WAS서버1
  : WEB 서버에서 핸들링당하는 WAS2 서버이다. 

  1. ssh 권한부여
  2. 목적에 맞는 스크립트 생성.

  ```bash
  sudo vi /etc/sudoers

  # User privilege specification
  root        ALL=(ALL:ALL) ALL
  WAS2서버계정  ALL=(ALL:ALL) ALL  #권한부여 추가

  ```

## 문제
  : 위와 같이 만들고 테스트해본다.
  
  ```bash
  sh ~/script/dbd/server_hostname.sh

  # /etc/sudoers에 해당 계정의 권한을 설정했음에도, 아래와 같은 로그를 남기며 명령어 수행을 실패하는 경우가 있다.
  # sudo: sorry, you must have a tty to run sudo
  # (sudo: 존재하는 tty가 없으며 askpass 프로그램을 지정하지 않았습니다)

  ```

### 원인과 해결
  : 해당 원인을 분석한 결과 /etc/sudoers 파일 내 Defaults requiretty 값이 설정되어 위와 같은 에러가 발생했다. Defaults requiretty 이 설정되면 cron 이나 agent 내부에서 sudo 명령어 실행이 불가능하며, 실제 tty(teletyperwriter, Linux 콘솔 or 터미널) 를 통해 접속된 상태에서만 sudo 명령어 실행이 가능하다.

  ```bash
  sudo vi /etc/sudoers  
   
  #Defaults requiretty  # 각각의 서버에 이부분을 주석(#) 처리하면 된다.

  ```

### ssh권한 적용완료

> 완료
