---
title:  "라즈베리파이(14) WEB WAS 연동"
excerpt: "라즈베리파이(14) WEB WAS 연동 입니다."
categories:
  - web-service-dev
tags:
  - [web, dev]
toc: true
toc_sticky: true

last_modified_at: 2022-10-12T20:00:00-05:00
---

# 라즈베리파이 WEB WAS 로드밸런싱
## 로드밸런싱 개요
  : 라즈베리파이에 Apache & Tomcat서버를 로드밸런싱 한다.

  - 1대의 웹서버를 바라보는 WAS서버 2대를 구성한다.
  - 물리적으로 서버를 분리하여 부하를 줄인다.
  - mod_jk의 load balancing방식은 기본적으로 round robin이지만 한번 왔던 요청은 같은 Engine에 보내준다.


## 로드밸런싱 구축
### WEB서버 mod_jk 설정
  : 웹서버(아파치) 측의 설정.

  1. (아파치루트/톰캣커넥터루트/workers.properties) 설정
    : 워커를 정의 및 로드 밸런싱을 위한 다중화 톰캣 설정을 한다.

      ```bash
      # ASIS
      # worker.list=lilo_lb                     # 리스트정의
      # worker.lilo_lb.type=lb                  # 타입정의
      # worker.lilo_lb.balance_workers=worker1  # load balancing할 worker 속성 지정, (worker1)를 lilo_lb 라는 리스트 하위에 추가한다.
      # worker.worker1.port=8009                # mod_jk 가 이용하는 APJ 연동 포트
      # worker.worker1.host=192.168.0.10        # 연동시킬 나의 다른 라즈베리파이 WAS서버 주소를 입력
      # worker.wokrer1.type=ajp13               # 연동모듈 프로토콜


      # TOBE
      worker.list=blang_balancer
      worker.blang_balancer.type=lb
      worker.blang_balancer.balance_workers=tomcat1,tomcat2

      # Server1
      worker.tomcat1.port=18009          # 로드밸런싱 전용포트 포트중첩불가 톰캣에서 설정한 포트와 일치해야함
      worker.tomcat1.host=192.168.0.10
      worker.tomcat1.type=ajp13
      worker.tomcat1.lbfactor=1          # 서버밸런스비율

      # Server2
      worker.tomcat2.port=28009
      worker.tomcat2.host=192.168.0.12
      worker.tomcat2.type=apj13
      worker.tomcat2.lbfactor=1

      ```
      
  2. (아파치루트/conf/httpd.conf) 설정
    : 톰캣에 통과시킬 매핑을 정의하는 jk마운트를 최종 설정한다.

      ```bash
      # 최종으로 mod_jk JK마운트로 worker를 등록한다. url를 구분하여 톰캣이 처리할지 결정한다.
      # /* 으로들어오는 요청을 blang_balancer 라는 워커로 넘긴다.
      # 워커 설정에는 로드밸런싱이 설정되어있다.
      # tomcat1, tomcat2 골고루 요청을 분산해줄 것이다.

      # ASIS
      #jkMount /* lilo_lb

      # TOBE
      jkMount /* blang_balancer

      ```

      
      
### WEB서버 mod_jk 설정
  : 웹서버(아파치) 측의 설정.

  1. (아파치루트/conf/httpd.conf) 설정
    : mod_jk를 연동하는 설정과 mod_jk.conf의 경로를 지정하여 요청 처리에 대한 설정 및 로그 파일 등을 기술한다.

      ```bash
      ```
      
