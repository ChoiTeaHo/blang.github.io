---
title: "차트구현"
excerpt: "차트구현 입니다."

categories:
  - temp
tags:
  - [oracle, schema]
toc: true
toc-stiky: true
last_modified_at: 2023-08-12T13:00:00-05:00:00
---

## 백앤드
### 컨트롤러
```java
// 테스트 컨트롤러
	@RequestMapping(value = "/test", method = RequestMethod.GET)
	public String test(Model model) {
		
		logger.info("HomeController test start  >>");
		
		// REST API 임시
		//strJsonStr = BlangJsonUtil.creatJsonObj1();
		//strJsonStr = BlangJsonUtil.creatJsonObj2();
		//strJsonStr = BlangJsonUtil.creatJsonObj3();
		//strJsonStr = BlangJsonUtil.creatJsonObj4();
		
		/*********************************
		 * JSON 핸들링
		 **********************************/
		// [Gson 활용]
		java.lang.reflect.Type mapType = new com.google.gson.reflect.TypeToken<Map<String, Object>>(){}.getType();
		Gson gson = new Gson();
		Map<String, Object> mapResult = new HashMap<String, Object>();  
		
		
		// Yarn Resource Manager API ROOT KEY 
		String yarnResource[] = {"clusterMetrics", "clusterInfo"};
		
		// API ROOT KEY 횟수 루프
		for(int i=0; i<yarnResource.length; i++) {
			
			// STEP1. API 요청후 JSON 얻기
			String getYarnJson = BlangJsonUtil.getYarnData(yarnResource[i]); // JSON 문자열
			System.out.println("■ API요청으로 받은 JSON 형태의 String: "+ getYarnJson);
			
			// STEP2. 얻은 JSON 키값의 데이터타입별로 GSON 라이브러리로 Map<String, Object> 동적처리.
			Map<String, Object> mapJson = gson.fromJson(getYarnJson, mapType);
			System.out.println("■ API요청으로 받은 JSON 형태의 String 데이터를 객체로 파싱: " + mapJson);
			
			// STEP3. ROOT KEY ACCESS
			Map<String, Object> accessData = (Map<String, Object>) mapJson.get(yarnResource[i]);
			System.out.println("■ 파싱한 데이터에서 JSON KEY 엑세스: " + accessData);
			
			// STEP4. JS가 인식가능한 완벽한 JSON 문자열 생성
			if (accessData != null) {
				String resultData = BlangJsonUtil.mapToJson(accessData); // 완벽한 JSON 만들기
				mapResult.put(yarnResource[i], resultData); //API 별로 MAP생성
				System.out.println("■ 엑세스한 JSON 데이터의 키,값을 완벽한 JSON 문자열로 변경 " + resultData);
			}
		}
		
		// 키값은 Yarn Resource Manager REST API 문서 참고
		System.out.println("■mapResult " + mapResult);
		System.out.println("■mapResult " + mapResult.get("availableVirtualCores"));
		System.out.println("■clusterMetrics " + mapResult.get("clusterMetrics"));
		System.out.println("■clusterInfo " + mapResult.get("clusterInfo"));
		
		model.addAttribute("mapResult", mapResult);

		
		return "jsp/test/BDP002023M00";
	}

```

### 유틸리티
```java
	/*********************
	 * MAP객체를 JS가 인식할 수 있는 JSON 형태 문자열로 변경<br>
	 *  
	 * @param mapJson - Map<String, Object> 타입
	 * @return String 완전한 JSON 형태의 문자열
	 *********************/
    public static String mapToJson(Map<String, Object> mapJson) {
      ..  if(true) {

	        } else if(value instanceof Integer) {
	        	// Gson 라이브러리의 키값이 int 형은 double 로 처리
	        	jsonStringBuilder.append("\"").append(value).append("\"");
          }
      ..
    }

```


## 프론트
### JSP

```jsp
<%@page contentType="text/html; charset=EUC-KR" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ page import="org.json.JSONObject"%>

<!DOCTYPE html>
<html>
<head>
<script src="./resources/js/jquery-3.4.1.min.js"></script>
<script src="./resources/js/aos.js"></script>
<script src="./resources/js/toastui-chart.min.js"></script>
<link rel="stylesheet" href="./resources/css/test.css">
<link rel="stylesheet" href="./resources/css/aos.css">
<link rel="stylesheet" href="./resources/css/toastui-chart.min.css">
<link rel="stylesheet" href="./resources/css/font.css">


<title>test</title>
</head>
<body>
	<h1>test page</h1>

	<!-- String (for Perfect ORIGNAL JSON) -->
	<h3>
		<i>완전한 json 문자열 전달</i>
	</h3>
	<ul>
		<li><b>JSON String: </b> ${type0}</li>
	</ul>
	<hr>

	<!-- List<Map<String, Object>> documnet -->
	<h3>
		<i>document 전달</i>
	</h3>
	<c:forEach var="item" items="${type1}">
		<ul>
			<li><b>document 객체: </b> ${type1}</li>
			<li><b>status: </b> ${item.status}</li>
			<li><b>msg: </b> ${item.msg}</li>
			<li><b>result: </b> ${item.result}</li>
			<li><b>address: </b> ${item.address}</li>
			<c:forEach var="address" items="${item.address}">
				<ul>
					<li><b>data1(key): </b> ${address.data1}</li>
					<li><b>data2(key): </b> ${address.data1}</li>
				</ul>
			</c:forEach>
			<li><b>language(한글EL불가):</b> ${item.language}</li>
		</ul>
	</c:forEach>
	<hr>

	<!-- Map<String, Object> type2 = testDto.getEtc();  -->
	<h3>
		<i>etc 전달</i>
	</h3>
	<ul>
		<li><b>etc 객체: </b> ${type2}</li>
		<p>name: ${type2.name}</p>
	</ul>
	<hr>

	<button id='btn-live1'>버튼1</button>
	<button id='btn-live2'>버튼2</button>
	<div id="chart" data-aos="fade-down" data-aos-duration="2000"></div>




	<div class="aos-container item" data-aos="fade-up" data-aos-duration="2000">1</div>
	<div class="aos-container item" data-aos="fade-down" data-aos-duration="2000">2</div>
	<div class="aos-container item" data-aos="fade-right" data-aos-duration="2000">3</div>
	<div class="aos-container item" data-aos="fade-left" data-aos-duration="2000">4</div>

	<div class="aos-container item" data-aos="zoom-in" data-aos-duration="2000">5</div>
	<div class="aos-container item" data-aos="zoom-out" data-aos-duration="2000">6</div>

	<div class="aos-container item" data-aos="slide-up" data-aos-duration="2000">7</div>

	<div class="aos-container item" data-aos="flip-up" data-aos-duration="2000">8</div>
	<div class="aos-container item" data-aos="flip-down" data-aos-duration="2000">9</div>
	<div class="aos-container item" data-aos="flip-right" data-aos-duration="2000">10</div>
	<div class="aos-container item" data-aos="flip-left" data-aos-duration="2000">11</div>


	<div class="aos-container item" data-aos="flip-left" data-aos-duration="3000">12</div>
	
	

</body>

<script>

let clusterMetrics = "";
let clusterInfo = "";
//let inputXY;

$(document).ready(function (){
	
	/* Yarn Resource Manager REST API */
	let jsonMetrics = '${mapResult.clusterMetrics}';
	let jsonInfo = '${mapResult.clusterInfo}';
	
	if (jsonMetrics != null) {
		clusterMetrics = JSON.parse(jsonMetrics); //함수 성공조건: 완벽한 JSON 문자열이여야 함.
		console.log(clusterMetrics.appsRunning);
		console.log(clusterMetrics.appsPending);
		
		console.log("allocatedVirtualCores: " + clusterMetrics.allocatedVirtualCores); //할당된 가상 코어 수
		console.log("availableVirtualCores: " + clusterMetrics.availableVirtualCores); //사용 가능한 가상 코어 수
		console.log("totalVirtualCores: " + clusterMetrics.totalVirtualCores); //전체 가상 코어 수
		
		console.log("allocatedMB: " + clusterMetrics.allocatedMB); //할당된 메모리 (메가바이트)
		console.log("availableMB: " + clusterMetrics.availableMB); //사용 가능한 메모리 (메가바이트)
		console.log("totalMB: " + clusterMetrics.totalMB); //전체 메모리 용량 (메가바이트)
		
		
		
		
	}
	if (jsonInfo != null) {
		clusterInfo = JSON.parse(jsonInfo); //함수 성공조건: 완벽한 JSON 문자열이여야 함.
		console.log(clusterInfo.state);
	}
	
	/* AOS */
	AOS.init();

	/* TOAST UI CHART */
	var Chart = toastui.Chart;
	
	const liveLineChart = fn_chart4(Chart);
	const btnLive1 = document.getElementById("btn-live1");	// 클릭 이벤트 리스너 추가
	btnLive1.addEventListener("click", function() {
		
		// x좌표와 y좌표를 받아야 한다. 
		// x는 시간 y는 수치다.
		//var inputXY = [{x:4,y:60}];
		// 새로운 데이터를 차트에 추가 (버튼)
		//liveLineChart(getXData, getYData, "SiteA");
	    
		// 10초마다 새로운 데이터를 차트에 추가 
    	setInterval( () => {
    		liveLineChart(Math.floor(Math.random() * 10), Math.floor(Math.random() * 10), "RunningAppsFromAllUsers");
    	}, 3000); // 10000ms = 10초
    
	});
	
	const livePieChart = fn_chart3(Chart);
	const btnLive2 = document.getElementById("btn-live2");
	btnLive2.addEventListener("click", function() {
		setInterval(() => {livePieChart(Math.floor(Math.random() * 10), Math.floor(Math.random() * 10), "Running Apps From All Users")}, 3000); // 10000ms = 10초
	});
	
	
	
	fn_chart2(Chart);
	
	

});


function fn_chart2(Chart) {
	
    // 데이터 준비
	const el = document.getElementById('chart');
    const data = {
    categories: ['vcores - Usages'],
       series: [
         {
           name: 'allocatedVirtualCores',
           data: parseInt(clusterMetrics.allocatedVirtualCores),
         },
         {
           name: 'availableVirtualCores',
           data: parseInt(clusterMetrics.availableVirtualCores),
         },
       ],
    }; 
	const options = {
		chart:{ width: 700, height: 400 },
		series: {
			dataLabels: {
		    	visible: true,
		        pieSeriesName: { visible: true }
		    }
		}
	};
    
    
	const chart = Chart.pieChart({ el, data, options });
	//const chart = new BarChart({ el, data, options }); // 두 번째 방법
}


// availableMB	long	사용 가능한 메모리 (메가바이트)
// allocatedMB	long	할당된 메모리 (메가바이트)
// totalMB	long	전체 메모리 용량 (메가바이트)
function fn_chart3(Chart) {
	
    // 데이터 준비
	const el = document.getElementById('chart');
    const data = {
    categories: ['memeory-mb - Usages'],
       series: [
         {
           name: 'allocatedMB',
           data: parseInt(clusterMetrics.allocatedMB),
         },
         {
           name: 'availableMB',
           data: parseInt(clusterMetrics.availableMB),
         },
       ],
    }; 
	const options = {
		chart:{ width: 700, height: 400 },
		series: {
			shift: true,
			dataLabels: {
		    	visible: true,
		        pieSeriesName: { visible: true }
		    }
		}
	};
    
    
	const chart = Chart.pieChart({ el, data, options });
	//const chart = new BarChart({ el, data, options }); // 두 번째 방법
	
	return fn_callback_chart(chart);
}


// 라인차트 
 function fn_chart4(Chart) {
	
    // 데이터 준비
	const el = document.getElementById('chart');
	 const data = {
			 categories: ['Running Apps From All Users'],
			  series: [
			    {
			      name: 'SiteA',
			      data: [
			        { x: 0, y: 0 },      
			      ],
			    },
			    {
			      name: 'SiteB',
			      data: [
			    	{ x: 0, y: 0 },
			      ],
			    },
			  ],
			}
	    const options = {
		        chart: { width: 700, height: 400 },
		        xaxis: {
		            type: 'numeric', // 숫자 형식으로 x축 설정
		        },
		        series: {
		            shift: true,
		            dataLabels: {
		                visible: true,
		                pieSeriesName: { visible: true }
		            }
		        },
		    };
    
	 const chart = Chart.lineChart({ el, data, options });
	 chart.addData([{x: 0, y: parseInt(clusterMetrics.appsRunning)},{x: 0, y: parseInt(clusterMetrics.appsPending)}], "Running Apps From All Users");
	 
	// 콜백함수로 실시간 함수내보내기 
	/*
	function callLineChart(chart) {
		
		let xValue = 10; // 초기 x 값
		const liveObject = (xData, yData, newCategory) => {
			xValue += 10; // 10초 간격으로 x 값을 증가
			var newItem = [
			    { x: xValue, y: xData }, { x: xValue, y: yData } // 하나의 데이터 포인트만 포함하는 객체
			];
			
			chart.addData(newItem, newCategory);
		}
		return liveObject;
	}
	*/

		
	return fn_callback_chart(chart);	
	
}

 
	function fn_callback_chart(chart) {
		
		let xValue = 10; // 초기 x 값
		const liveObject = (xData, yData, newCategory) => {
			xValue += 10; // 10초 간격으로 x 값을 증가
			
			const newItem = '';
			if (newCategory == 'RunningAppsFromAllUsers') {
				newItem = [
				    { x: xValue, y: xData }, { x: xValue, y: yData } // 하나의 데이터 포인트만 포함하는 객체
				];	
			} else {
				//'memeory-mb - Usages'
			}
			
			chart.addData(xData, RunningAppsFromAllUsers);
		}
		return liveObject;
	}
 
 </script>

</html>

```
