---
title: "트랜잭션"
excerpt: "트랜잭션 입니다."

categories:
  - temp
tags:
  - [oracle, schema]
toc: true
toc-stiky: true
last_modified_at: 2023-08-08T09:00:00-18:00:00
---

## 트랜잭션 기본 
> ❗<span style='color:green'>***트랜잭션의 기본 형태***</span>  
> 💡 1.<span style='color:blue'>**connection 의 auto commit 를 false 로 주고**</span>  
> 💡 2.<span style='color:blue'>**try catch 를 이용해서 commit 또는 rollback 하는 것이 기본이다.**</span>  

## 스프링 트랜잭션
> ❗<span style='color:green'>***스프링 트랜잭션 개념***</span>  
> 💡 <span style='color:blue'>**스프링 같은 프레임워크 설정에서 특정 이름이나 특정 패키지 클래스에 무조건 걸리게 설정.**</span>  
> 💡 <span style='color:blue'>**특정위치에 어노테이션 형태로 사용할수도 있게 간편화 시킨 것 일뿐이다.**</span>  

## 트랜잭션 비권장 상황
> ❗<span style='color:green'>***비권장 상황***</span>  
> 💡 <span style='color:blue'>**많은 경우중 트랜잭션을 사용하지 않는것이 유리한 경우는 대량의 데이터를 처리하는 batch 처리하는게 좋다.**</span>  
> 💡 <span style='color:blue'>**예를들어 99만건까지 들어가고 에러가나면 롤백에도 한참이 걸리고 심지어 어느 로우에서 발생한 문제인지 찾기도 매우 어렵다.**</span>  
> 💡 <span style='color:blue'>**작게 쪼개보면.. select 문에 트랜잭션을 거는것은 낭비다.**</span>  


## 예시
### Service1
```java
@Service
public class TBBCKW001ServiceImpl implements TBBCKW001Service {

	@Inject
	private TBBCKW001 dao;
	
	@Transactional
	/* 회원일련번호를 생성해서 가져온다. */
	public String getSqMmsn() throws Exception {
		return dao.getSqMmsn();
	}

	/* TBBCKW001 정보를 생성한다. */
	@Transactional
	@Override
	public int setInsert(TBBCKW001DTO TBBCKW001) throws Exception {
		return dao.setInsert(TBBCKW001);
	}
}

```

### Service2
```java
@Service
public class TBBCKW002ServiceImpl implements TBBCKW002Service {

	@Inject
	private TBBCKW002 dao;

	/* 회원일련번호를 생성해서 가져온다. */
	@Transactional
	@Override
	public String getSqSlfMmsn() throws Exception {
		return dao.getSqSlfMmsn();
	}

	/* TBBCKW002 정보를 생성한다. */
	@Transactional
	@Override
	public int setInsert(TBBCKW002DTO TBBCKW002) throws Exception {
		return dao.setInsert(TBBCKW002);
	}
}

```

> ❗<span style='color:green'>***@Transactional 어노테이션 추가***</span>  

### Controller
```java
@Inject
TBBCKW001Service tBBCKW001Service;
@Inject
TBBCKW002Service tBBCKW002Service;

@Transactional
public void executeTransactionalOperation() throws Exception {
    // 두 서비스 메소드를 순차적으로 호출
    String sqMmsn = tBBCKW001Service.getSqMmsn();
    TBBCKW001DTO tbbckw001DTO = new TBBCKW001DTO();
    // 필요한 작업 수행
    tBBCKW001Service.setInsert(tbbckw001DTO);
    String sqSlfMmsn = tBBCKW002Service.getSqSlfMmsn();
    TBBCKW002DTO tbbckw002DTO = new TBBCKW002DTO();
    // 필요한 작업 수행
    tBBCKW002Service.setInsert(tbbckw002DTO);
}

```


## 실제테스트 해보기
### 기업테이블
![사진1](/assets/images/WebProgramming/Spring/spring-transaction-test1.png)
### 사용자테이블
![사진2](/assets/images/WebProgramming/Spring/spring-transaction-test2.png)

> ❗<span style='color:green'>***@Transactional 테스트 준비***</span>  
> 💡 <span style='color:blue'>**테스트 테이블은 총 2개**</span>  
> 💡 <span style='color:blue'>**테스트 테이블은 총 2개**</span>  

